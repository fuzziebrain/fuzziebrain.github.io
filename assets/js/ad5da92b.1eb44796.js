"use strict";(self.webpackChunknewsite=self.webpackChunknewsite||[]).push([[28888],{3905:(e,t,a)=>{a.r(t),a.d(t,{MDXContext:()=>c,MDXProvider:()=>u,mdx:()=>_,useMDXComponents:()=>p,withMDXComponents:()=>d});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o.apply(this,arguments)}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),d=function(e){return function(t){var a=p(t.components);return n.createElement(e,o({},t,{components:a}))}},p=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(c.Provider,{value:t},e.children)},m="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(a),u=r,m=d["".concat(l,".").concat(u)]||d[u]||h[u]||o;return a?n.createElement(m,i(i({ref:t},c),{},{components:a})):n.createElement(m,i({ref:t},c))}));function _(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,l=new Array(o);l[0]=g;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[m]="string"==typeof e?e:r,l[1]=i;for(var c=2;c<o;c++)l[c]=a[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},62990:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var n=a(87462),r=(a(67294),a(3905));const o={title:"Manipulating the Oracle Cloud with PL/SQL",tags:["oracle","cloud","plsql","rest","orclapex"],slug:"id/2009",authors:["fuzziebrain"],categories:["Technology","Infrastructure","Oracle Cloud"],date:new Date("2020-10-15T23:06:16.000Z")},l=void 0,i={permalink:"/content/id/2009",source:"@site/posts/manipulating-oci-with-pl-sql/index.md",title:"Manipulating the Oracle Cloud with PL/SQL",description:"Slide on OCI REST APIs updated",date:"2020-10-15T23:06:16.000Z",formattedDate:"October 15, 2020",tags:[{label:"oracle",permalink:"/content/tags/oracle"},{label:"cloud",permalink:"/content/tags/cloud"},{label:"plsql",permalink:"/content/tags/plsql"},{label:"rest",permalink:"/content/tags/rest"},{label:"orclapex",permalink:"/content/tags/orclapex"}],readingTime:4.04,hasTruncateMarker:!0,authors:[{name:"Adrian Png",title:"Senior Cloud Solutions Architect @ Insum",url:"https://github.com/fuzziebrain",imageURL:"https://github.com/fuzziebrain.png",key:"fuzziebrain"}],frontMatter:{title:"Manipulating the Oracle Cloud with PL/SQL",tags:["oracle","cloud","plsql","rest","orclapex"],slug:"id/2009",authors:["fuzziebrain"],categories:["Technology","Infrastructure","Oracle Cloud"],date:"2020-10-15T23:06:16.000Z"},prevItem:{title:"Making AI Accessible to APEX",permalink:"/content/id/2010"},nextItem:{title:"New Book on Getting the Most Out of the Oracle Cloud Free Tier",permalink:"/content/id/2008"}},s={authorsImageUrls:[void 0]},c=[{value:"Required Database Privileges",id:"required-database-privileges",level:2},{value:"OCI Setup",id:"oci-setup",level:2},{value:"Closing",id:"closing",level:2}],d={toc:c};function p(e){let{components:t,...o}=e;return(0,r.mdx)("wrapper",(0,n.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Slide on OCI REST APIs updated",src:a(29040).Z,width:"1280",height:"800"})),(0,r.mdx)("p",null,"It was only days ago that I had finalised my slides for my upcoming Oracle Groundbreakers APAC Virtual Tour ",(0,r.mdx)("a",{parentName:"p",href:"https://oracle-groundbreakers-apac-virtual-tour-2020.heysummit.com/talks/store-your-treasures-in-the-cloud-1/"},"talk")," on using ",(0,r.mdx)("a",{parentName:"p",href:"https://oracle.com/cloud"},"Oracle Cloud Infrastructure")," (OCI) Object Storage for storing large files in ",(0,r.mdx)("a",{parentName:"p",href:"https://apex.oracle.com"},"Oracle Application Express")," (APEX). Today, I found out with a lot of excitement, that one of my slides was now factually wrong!"),(0,r.mdx)("p",null,"For a while now, Oracle has provided SDKs (Software Development Kits) for a wide range of programming languages, but strangely, that didn't include PL/SQL. Thankfuly, the wait and bewilderment is now finally over! Well, at least for folks who are running their applications on the ",(0,r.mdx)("a",{parentName:"p",href:"https://www.oracle.com/autonomous-database/"},"Oracle Autonomous Database")," (ADB). And yes, even if you're on an ",(0,r.mdx)("a",{parentName:"p",href:"https://oracle.com/cloud/free"},(0,r.mdx)("em",{parentName:"a"},"Always Free"))," instance."),(0,r.mdx)("p",null,"Don't believe me? Use your favourite database client and login to your ADB instance using the ",(0,r.mdx)("em",{parentName:"p"},"admin")," account. Run the query below to get a list of available packages that line up with the APIs listed ",(0,r.mdx)("a",{parentName:"p",href:"https://docs.cloud.oracle.com/iaas/pl-sql-sdk/index.html"},"here"),"."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"select object_name\nfrom dba_objects\nwhere object_name like 'DBMS_CLOUD_OCI_%'\n  and object_type = 'PACKAGE'\norder by object_name;\n")),(0,r.mdx)("p",null,"You should see a long list of 70 packages (at the time of writing), something like this:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},"OBJECT_NAME\n----------------------------------------\nDBMS_CLOUD_OCI_AD_AUDIT\nDBMS_CLOUD_OCI_AG_DEPLOYMENT\nDBMS_CLOUD_OCI_AG_GATEWAY\nDBMS_CLOUD_OCI_AG_WORK_REQUESTS\nDBMS_CLOUD_OCI_AM_APPLICATION_MIGRATION\nDBMS_CLOUD_OCI_AN_ANALYTICS\nDBMS_CLOUD_OCI_ASC_AUTO_SCALING\nDBMS_CLOUD_OCI_AS_ANNOUNCEMENT\nDBMS_CLOUD_OCI_BC_BLOCKCHAIN_PLATFORM\nDBMS_CLOUD_OCI_BDS_BDS\nDBMS_CLOUD_OCI_BD_BUDGET\n...\nDBMS_CLOUD_OCI_WS_WAAS\n\n70 rows selected.\n")),(0,r.mdx)("h2",{id:"required-database-privileges"},"Required Database Privileges"),(0,r.mdx)("p",null,"To use them with your application schema, e.g. ",(0,r.mdx)("em",{parentName:"p"},"myapp"),", you will need to do the following tasks. Begin with the ",(0,r.mdx)("em",{parentName:"p"},"admin")," account."),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},"Allow ",(0,r.mdx)("em",{parentName:"li"},"myapp")," to create the required OCI Cloud Services credentials (OCI credentials). We will discuss what this is in greater detail later. The procedures that you will need are in the package ",(0,r.mdx)("inlineCode",{parentName:"li"},"DBMS_CLOUD"),".",(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"grant execute on dbms_cloud to myapp;\n"))),(0,r.mdx)("li",{parentName:"ol"},"Identify the API and corresponding PL/SQL package that you wish to use. For example, to access the Object Storage, I will require privileges to the package ",(0,r.mdx)("inlineCode",{parentName:"li"},"DBMS_CLOUD_OCI_OBS_OBJECT_STORAGE"),".",(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"grant execute on dbms_cloud_oci_obs_object_storage to myapp;\n"))),(0,r.mdx)("li",{parentName:"ol"},"Check the API reference and identify database types that you might need to use and grant these privileges as well. For example, in my code, I will be declaring a variable of the type ",(0,r.mdx)("inlineCode",{parentName:"li"},"dbms_cloud_oci_obs_object_storage_list_buckets_response_t"),".",(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"grant execute on dbms_cloud_oci_obs_object_storage_list_buckets_response_t to myapp;\n")))),(0,r.mdx)("h2",{id:"oci-setup"},"OCI Setup"),(0,r.mdx)("p",null,"Setup the Object Storage bucket, user, group and policy using the steps described in my Oracle Magazine article ",(0,r.mdx)("a",{parentName:"p",href:"https://blogs.oracle.com/oraclemagazine/better-file-storage-in-oracle-cloud"},"Better File Storage in Oracle Cloud"),", specifically:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"Identity Setup; and"),(0,r.mdx)("li",{parentName:"ul"},"Bucket Setup")),(0,r.mdx)("p",null,"Be sure to generate the API keypair and associate it with the OCI user that will act on your application's behalf. Also ensure that this user has the necessary policies applied. Finally, please note the following information to setup the required OCI credentials:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"User's ocid"),(0,r.mdx)("li",{parentName:"ul"},"Tenancy ocid"),(0,r.mdx)("li",{parentName:"ul"},"Private key"),(0,r.mdx)("li",{parentName:"ul"},"Fingerprint")),(0,r.mdx)("p",null,"Next, connect to the database as the application user/schema. You will need to execute the procedure ",(0,r.mdx)("inlineCode",{parentName:"p"},"DBMS_CLOUD.CREATE_CREDENTIAL"),". There are two overloaded procedures and you ",(0,r.mdx)("strong",{parentName:"p"},"must")," execute the procedure for the ",(0,r.mdx)("em",{parentName:"p"},"OCI Signing Key Credentials"),"."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"begin\n  dbms_cloud.create_credential(\n    credential_name => 'MY_OCI_CRED'\n    , user_ocid => 'ocid1.user.oc1..aaaaaaaa**********'\n    , tenancy_ocid => 'ocid1.tenancy.oc1..aaaaaaaa**********'\n    , private_key => 'MIIE**********='\n    , fingerprint => '**:**:**:**:**:**:**:**:**:**:**:**:**:**:**:**'\n  );\nend;\n/\n")),(0,r.mdx)("blockquote",null,(0,r.mdx)("p",{parentName:"blockquote"},(0,r.mdx)("strong",{parentName:"p"},"NOTE")),(0,r.mdx)("p",{parentName:"blockquote"},"The private key is to be prepared the same way we do when setting up the ",(0,r.mdx)("em",{parentName:"p"},"Web Credentials")," in APEX for OCI. Remove the header, footer and any newlines in the PEM-formatted contents.")),(0,r.mdx)("p",null,"Check that the OCI credentials were created successfully using the following query:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"select credential_name, username from user_credentials;\n")),(0,r.mdx)("p",null,"Now run the following sample code to get the list of Object Storage buckets in the compartment defined in the parameter ",(0,r.mdx)("inlineCode",{parentName:"p"},"compartment_id"),". You will need to also specify your tenancy's Object Storage namespace and region."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"declare\n  where_are_my_buckets dbms_cloud_oci_obs_object_storage_list_buckets_response_t;\nbegin\n  where_are_my_buckets :=\n      dbms_cloud_oci_obs_object_storage.list_buckets(\n        namespace_name => 'mynamespace'\n        , compartment_id => 'ocid1.compartment.oc1..aaaaaaaa**********'\n        , region => 'us-ashburn-1'\n        , credential_name => 'MY_OCI_CRED'\n      );\n  dbms_output.put_line('status code: ' || where_are_my_buckets.status_code);\n  dbms_output.put_line('bucket count ' || where_are_my_buckets.response_body.count);\n  for i in 1..where_are_my_buckets.response_body.count\n  loop\n    dbms_output.put_line('bucket: ' || where_are_my_buckets.response_body(i).name);\n  end loop;\nend;\n/\n")),(0,r.mdx)("p",null,"You should get an output similar to this:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},"status code: 200\nbucket count 2\nbucket: apex_file_storage\nbucket: data-import\n")),(0,r.mdx)("h2",{id:"closing"},"Closing"),(0,r.mdx)("p",null,"I have barely scratched the surface of what we can do with this new PL/SQL SDK for OCI REST APIs, especially for OCI adminsitrators and APEX developers looking to ",(0,r.mdx)("a",{parentName:"p",href:"https://insum.ca/oracle-cloud-native-and-oracle-application-express/"},"integrate Cloud Native")," features in their applications. The APEX team did us developers a huge service when the web credentials for OCI was introduced in version 19.2. It greatly simplified how we accessed the OCI REST services. However, not every endpoint worked out-of-the-box and I have found problems accessing some endpoints. We also had to write our own code for constructing the request payload and parsing the responses. This SDK handles and shields us from all the low-level marshalling tasks, and provides a structured approach for retrieving information from the API responses."),(0,r.mdx)("p",null,"The power of the ",(0,r.mdx)("a",{parentName:"p",href:"https://blogs.oracle.com/database/what-is-a-converged-database"},"Converged Database")," is here. One database to rule them all! ",(0,r.mdx)("a",{parentName:"p",href:"https://twitter.com/hashtag/thinkautonomous"},"#ThinkAutonomous")))}p.isMDXComponent=!0},29040:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/slide-updated-73c3bbfb58ca0798f537091a8432738e.png"}}]);