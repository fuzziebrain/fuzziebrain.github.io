"use strict";(self.webpackChunknewsite=self.webpackChunknewsite||[]).push([[79956],{3905:(e,a,t)=>{t.r(a),t.d(a,{MDXContext:()=>l,MDXProvider:()=>c,mdx:()=>x,useMDXComponents:()=>p,withMDXComponents:()=>d});var n=t(67294);function o(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(){return s=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},s.apply(this,arguments)}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){o(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function m(e,a){if(null==e)return{};var t,n,o=function(e,a){if(null==e)return{};var t,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||(o[t]=e[t]);return o}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=n.createContext({}),d=function(e){return function(a){var t=p(a.components);return n.createElement(e,s({},a,{components:t}))}},p=function(e){var a=n.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},c=function(e){var a=p(e.components);return n.createElement(l.Provider,{value:a},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},f=n.forwardRef((function(e,a){var t=e.components,o=e.mdxType,s=e.originalType,r=e.parentName,l=m(e,["components","mdxType","originalType","parentName"]),d=p(t),c=o,h=d["".concat(r,".").concat(c)]||d[c]||u[c]||s;return t?n.createElement(h,i(i({ref:a},l),{},{components:t})):n.createElement(h,i({ref:a},l))}));function x(e,a){var t=arguments,o=a&&a.mdxType;if("string"==typeof e||o){var s=t.length,r=new Array(s);r[0]=f;var i={};for(var m in a)hasOwnProperty.call(a,m)&&(i[m]=a[m]);i.originalType=e,i[h]="string"==typeof e?e:o,r[1]=i;for(var l=2;l<s;l++)r[l]=t[l];return n.createElement.apply(null,r)}return n.createElement.apply(null,t)}f.displayName="MDXCreateElement"},58860:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>m,contentTitle:()=>r,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var n=t(87462),o=(t(67294),t(3905));const s={title:"Say Hello From An Autonomous Database",tags:["oracle autonomous database","oracle cloud","email","slack","microsoft teams","msteams","communications","orclapex","oracle apex","plsql","dbms_cloud_notification"],authors:["fuzziebrain"],date:new Date("2023-04-17T00:00:00.000Z")},r=void 0,i={permalink:"/content/say-hello-from-an-autonomous-database",source:"@site/posts/say-hello-from-an-autonomous-database/index.md",title:"Say Hello From An Autonomous Database",description:"New features announced for Oracle Autonomous Database",date:"2023-04-17T00:00:00.000Z",formattedDate:"April 17, 2023",tags:[{label:"oracle autonomous database",permalink:"/content/tags/oracle-autonomous-database"},{label:"oracle cloud",permalink:"/content/tags/oracle-cloud"},{label:"email",permalink:"/content/tags/email"},{label:"slack",permalink:"/content/tags/slack"},{label:"microsoft teams",permalink:"/content/tags/microsoft-teams"},{label:"msteams",permalink:"/content/tags/msteams"},{label:"communications",permalink:"/content/tags/communications"},{label:"orclapex",permalink:"/content/tags/orclapex"},{label:"oracle apex",permalink:"/content/tags/oracle-apex"},{label:"plsql",permalink:"/content/tags/plsql"},{label:"dbms_cloud_notification",permalink:"/content/tags/dbms-cloud-notification"}],readingTime:9.92,hasTruncateMarker:!0,authors:[{name:"Adrian Png",title:"Senior Cloud Solutions Architect @ Insum",url:"https://github.com/fuzziebrain",imageURL:"https://github.com/fuzziebrain.png",key:"fuzziebrain"}],frontMatter:{title:"Say Hello From An Autonomous Database",tags:["oracle autonomous database","oracle cloud","email","slack","microsoft teams","msteams","communications","orclapex","oracle apex","plsql","dbms_cloud_notification"],authors:["fuzziebrain"],date:"2023-04-17T00:00:00.000Z"},nextItem:{title:"I Am Obsolete",permalink:"/content/id/2301"}},m={authorsImageUrls:[void 0]},l=[{value:"Create a Teams Application",id:"create-a-teams-application",level:2},{value:"Create a Bot and Configure the App Feature",id:"create-a-bot-and-configure-the-app-feature",level:2},{value:"Publish the Application",id:"publish-the-application",level:2},{value:"Tasks for Azure Active Directory Administrators",id:"tasks-for-azure-active-directory-administrators",level:2},{value:"Tasks for Teams Administrators",id:"tasks-for-teams-administrators",level:2},{value:"Sending Messages and Data to Teams",id:"sending-messages-and-data-to-teams",level:2},{value:"Create Credential",id:"create-credential",level:3},{value:"Team Channel Link",id:"team-channel-link",level:3},{value:"Send Message",id:"send-message",level:3},{value:"Send Data",id:"send-data",level:3},{value:"Notable Issues",id:"notable-issues",level:2},{value:"Version",id:"version",level:3},{value:"Error Messages",id:"error-messages",level:3},{value:"ORA-20010: Missing credential name",id:"ora-20010-missing-credential-name",level:4},{value:"ORA-20000: Cant Access Team, Check App has enough permission",id:"ora-20000-cant-access-team-check-app-has-enough-permission",level:4},{value:"ORA-20000: Cant Access Channel, Check App has enough permission",id:"ora-20000-cant-access-channel-check-app-has-enough-permission",level:4},{value:"Summary",id:"summary",level:2}],d={toc:l};function p(e){let{components:a,...s}=e;return(0,o.mdx)("wrapper",(0,n.Z)({},d,s,{components:a,mdxType:"MDXLayout"}),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"New features announced for Oracle Autonomous Database",src:t(7283).Z,width:"2140",height:"592"})),(0,o.mdx)("p",null,"In case you missed it, Oracle recently announced the availability of a new feature for the ",(0,o.mdx)("a",{parentName:"p",href:"https://www.oracle.com/autonomous-database/"},"Autonomous Database")," (ADB) that allows developers and database administrators to send messages using either emails, ",(0,o.mdx)("a",{parentName:"p",href:"https://slack.com"},"Slack"),", or ",(0,o.mdx)("a",{parentName:"p",href:"https://www.microsoft.com/microsoft-teams"},"Microsoft Teams")," (Teams). At ",(0,o.mdx)("a",{parentName:"p",href:"https://insum.ca"},"Insum"),", we use teams for internal communications and collaboration, and thus, you can appreciate my excitement when I heard about this feature release. Here's an early guide to getting started with ",(0,o.mdx)("inlineCode",{parentName:"p"},"DBMS_CLOUD_NOTIFICATION")," for those using Teams at their organisation."),(0,o.mdx)("blockquote",null,(0,o.mdx)("p",{parentName:"blockquote"},"Before we begin, it is worthwhile to note that for ",(0,o.mdx)("a",{parentName:"p",href:"https://apex.oracle.com"},"Oracle APEX"),", you can also send out emails and Slack/Teams using the ",(0,o.mdx)("inlineCode",{parentName:"p"},"APEX_MAIL")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"APEX_WEB_SERVICE")," PL/SQL APIs. This is an additional convenience feature that is provided with an ADB.")),(0,o.mdx)("p",null,"Setting up ",(0,o.mdx)("inlineCode",{parentName:"p"},"DBMS_CLOUD_NOTIFICATION")," to send Teams messages and data requires a few preparatory steps. You may read the details ",(0,o.mdx)("a",{parentName:"p",href:"https://docs.oracle.com/en/cloud/paas/autonomous-database/adbsa/send-msteams-notifications.html#GUID-80ACCB33-DF2D-42D7-AC01-23670B5B90E4"},"here")," but this blog post would provide further guidance and issues I noted when working through the steps."),(0,o.mdx)("h2",{id:"create-a-teams-application"},"Create a Teams Application"),(0,o.mdx)("p",null,"The first task that you will need to complete is to create a Teams application using the Teams ",(0,o.mdx)("a",{parentName:"p",href:"https://dev.teams.microsoft.com"},"developer portal"),". Create a new application and provide the following details:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"App names",(0,o.mdx)("ul",{parentName:"li"},(0,o.mdx)("li",{parentName:"ul"},"Short name"))),(0,o.mdx)("li",{parentName:"ul"},"Descriptions",(0,o.mdx)("ul",{parentName:"li"},(0,o.mdx)("li",{parentName:"ul"},"Short description"),(0,o.mdx)("li",{parentName:"ul"},"Long description"))),(0,o.mdx)("li",{parentName:"ul"},"Version"),(0,o.mdx)("li",{parentName:"ul"},"Developer information",(0,o.mdx)("ul",{parentName:"li"},(0,o.mdx)("li",{parentName:"ul"},"Developer or company name"),(0,o.mdx)("li",{parentName:"ul"},"Website"))),(0,o.mdx)("li",{parentName:"ul"},"App URLs",(0,o.mdx)("ul",{parentName:"li"},(0,o.mdx)("li",{parentName:"ul"},"Privacy policy"),(0,o.mdx)("li",{parentName:"ul"},"Terms of use")))),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"Provide the basic information required for the new application.",src:t(8816).Z,width:"2560",height:"1600"})),(0,o.mdx)("p",null,"Other than the ",(0,o.mdx)("em",{parentName:"p"},"Application (client) ID"),", you ",(0,o.mdx)("strong",{parentName:"p"},"must")," enter the required information to ensure the application passes validation and can be published successfully."),(0,o.mdx)("p",null,"Once you are satisfied with what you have entered, save the changes, and then return to the ",(0,o.mdx)("em",{parentName:"p"},"Dashboard")," to make sure there are no errors or warnings. Correct any if necessary."),(0,o.mdx)("h2",{id:"create-a-bot-and-configure-the-app-feature"},"Create a Bot and Configure the App Feature"),(0,o.mdx)("p",null,"Next, create a ",(0,o.mdx)("em",{parentName:"p"},"Bot"),". You can either do this by navigating to ",(0,o.mdx)("em",{parentName:"p"},"Tools")," > ",(0,o.mdx)("em",{parentName:"p"},"Bot management"),", or from within the ",(0,o.mdx)("em",{parentName:"p"},"Apps")," interface, navigate to ",(0,o.mdx)("em",{parentName:"p"},"App features")," and then click ",(0,o.mdx)("em",{parentName:"p"},"Bot"),". There, you will find the link ",(0,o.mdx)("em",{parentName:"p"},"Create a new bot"),"."),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"Create an app feature.",src:t(20606).Z,width:"2560",height:"1600"})),(0,o.mdx)("p",null,"Creating a bot is simple. You will only need to provide a name for the bot. After the bot is created, you will be redirected to the bot's details page. Navigate to the ",(0,o.mdx)("em",{parentName:"p"},"Client secrets"),", and then click the button ",(0,o.mdx)("em",{parentName:"p"},"Add a secret client for your bot"),". Store the generated client secret securely as it will only be displayed ",(0,o.mdx)("strong",{parentName:"p"},"once"),"."),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"Bot secret",src:t(52995).Z,width:"2560",height:"800"})),(0,o.mdx)("p",null,"Return to the ",(0,o.mdx)("em",{parentName:"p"},"Bots management")," page and note the ",(0,o.mdx)("em",{parentName:"p"},"Bot ID")," as well."),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"Bot ID",src:t(856).Z,width:"2560",height:"600"})),(0,o.mdx)("p",null,"After the bot has been created, return to the bot configuration in the app's feature page. Select the bot that you have just created, select the actions that the bot can do, and the scope."),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"Bot app feature configuration",src:t(71859).Z,width:"2560",height:"1600"})),(0,o.mdx)("h2",{id:"publish-the-application"},"Publish the Application"),(0,o.mdx)("p",null,"On the app's details page, navigate to ",(0,o.mdx)("em",{parentName:"p"},"Publish")," > ",(0,o.mdx)("em",{parentName:"p"},"Publish to org"),". At the bottom of the page, there should be a button to submit the app for publication. Click it and inform the Teams administrator."),(0,o.mdx)("h2",{id:"tasks-for-azure-active-directory-administrators"},"Tasks for Azure Active Directory Administrators"),(0,o.mdx)("p",null,"The next task involves defining the ",(0,o.mdx)("em",{parentName:"p"},"API permissions")," that the bot ",(0,o.mdx)("strong",{parentName:"p"},"must")," have. If you do not have permission to access the ",(0,o.mdx)("em",{parentName:"p"},"Azure Active Directory")," (Azure AD) console, then please work with the administrator to complete this step."),(0,o.mdx)("p",null,"When the bot was created, the platform automatically creates an ",(0,o.mdx)("em",{parentName:"p"},"App registration")," in Azure AD. You may access the app registrations using either ",(0,o.mdx)("a",{parentName:"p",href:"https://entra.microsoft.com"},"Microsoft Entra")," or the main ",(0,o.mdx)("a",{parentName:"p",href:"https://portal.azure.com"},"Azure portal"),". Locate the app registration for the bot and then navigate to the ",(0,o.mdx)("em",{parentName:"p"},"API permissions")," page. Add the following permissions:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"Files.ReadWrite.All")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"Sites.ReadWrite.All")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"ChannelSettings.Read.All"),(0,o.mdx)("sup",null,"*"))),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"Required API permissions",src:t(33117).Z,width:"2560",height:"1600"})),(0,o.mdx)("blockquote",null,(0,o.mdx)("p",{parentName:"blockquote"},(0,o.mdx)("strong",{parentName:"p"},"IMPORTANT")," The Oracle documentation does not include ",(0,o.mdx)("inlineCode",{parentName:"p"},"ChannelSettings.Read.All"),". I will discuss this in a later section.")),(0,o.mdx)("p",null,"Finally, click the ",(0,o.mdx)("em",{parentName:"p"},"Grant admin consent for {{TENANT}}")," link to allow the bot to access the specified APIs."),(0,o.mdx)("h2",{id:"tasks-for-teams-administrators"},"Tasks for Teams Administrators"),(0,o.mdx)("p",null,"In this next set of tasks, again, you may have to work with the administrators for your ",(0,o.mdx)("em",{parentName:"p"},"Microsoft 365")," tenancy or designated Teams administrator to approve and publish the Teams application. Access the Teams admin console ",(0,o.mdx)("a",{parentName:"p",href:"https://admin.teams.microsoft.com"},"here"),"."),(0,o.mdx)("p",null,"Navigate to ",(0,o.mdx)("em",{parentName:"p"},"Teams apps")," > ",(0,o.mdx)("em",{parentName:"p"},"Manage apps"),". The first thing you might notice is that there is an app that has been submitted and pending approval. In the table below, search and locate the application you have created."),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"Search for the Teams app.",src:t(2396).Z,width:"2560",height:"1600"})),(0,o.mdx)("p",null,"Click on the app, and on the app's details page, click ",(0,o.mdx)("em",{parentName:"p"},"Publish")," to approve the application for use in Teams."),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"Approve and publish the application.",src:t(25196).Z,width:"1280",height:"720"})),(0,o.mdx)("p",null,"It takes a little while for the app to show up in Teams for it to appear in the Teams ",(0,o.mdx)("em",{parentName:"p"},"Apps")," store under ",(0,o.mdx)("em",{parentName:"p"},"Built for your org")," category and then add it to team. A quick workaround is to add it to the team immediately using the admin console as show in the figure below."),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"Add the app to a team.",src:t(61868).Z,width:"2560",height:"1600"})),(0,o.mdx)("p",null,"In the table of apps, select the application and then click the button ",(0,o.mdx)("em",{parentName:"p"},"Add to team"),". Select the team you wish to add the app to, and then click the button ",(0,o.mdx)("em",{parentName:"p"},"Apply"),". Back in Teams, you may validate by accessing the team's management page and then click the tab ",(0,o.mdx)("em",{parentName:"p"},"Apps"),". You should see that the app has been added to the team."),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"App successfully added to team.",src:t(34832).Z,width:"2560",height:"1600"})),(0,o.mdx)("h2",{id:"sending-messages-and-data-to-teams"},"Sending Messages and Data to Teams"),(0,o.mdx)("p",null,"Now that you have fulfilled the prerequisites, it is time to test this feature."),(0,o.mdx)("h3",{id:"create-credential"},"Create Credential"),(0,o.mdx)("p",null,"In the document, it is stated that the ADB's ",(0,o.mdx)("em",{parentName:"p"},"ADMIN")," should create the credential, but I have tested it to work even with the credential created by the user. However, the schema that you wish to use to create the credentials ",(0,o.mdx)("strong",{parentName:"p"},"must")," have ",(0,o.mdx)("em",{parentName:"p"},"execute")," privilege on the ",(0,o.mdx)("inlineCode",{parentName:"p"},"DBMS_CLOUD")," package."),(0,o.mdx)("p",null,"Create the credential using the bot ID and secret:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-sql"},"begin\n  dbms_cloud.create_credential(\n    credential_name => 'TEAMS_CRED'\n    , username => '6b2c7*****f7a15'\n    , password => 'Abd8Q*****BSc~i'\n  );\nend;\n/\n")),(0,o.mdx)("h3",{id:"team-channel-link"},"Team Channel Link"),(0,o.mdx)("p",null,"In order to send messages and data, you will need ",(0,o.mdx)("strong",{parentName:"p"},"three")," parameters obtained from either the team's or channel's link. They look something like these:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"Team's link")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"https://teams.microsoft.com/l/team/19%3a94d8e*****d68aa%40thread.tacv2/conversations?groupId=23e1c*****ba568&tenantId=7d58a*****c60a0\n")),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"Team channel's link")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"https://teams.microsoft.com/l/channel/19%3aa94d8*****d68aa%40thread.tacv2/Monthly%2520Reports?groupId=23e1c*****ba568&tenantId=7d58a*****c60a0\n")),(0,o.mdx)("p",null,"The information you will need are the ",(0,o.mdx)("inlineCode",{parentName:"p"},"{{TEAM}}"),", ",(0,o.mdx)("inlineCode",{parentName:"p"},"{{CHANNEL}}")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"{{TENANT}}")," components as marked below:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"From the team's link")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"https://teams.microsoft.com/l/team/{{TEAM}}/conversations?groupId=23e1c*****ba568&tenantId={{TENANT}}\n")),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"From the team channel's link")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"https://teams.microsoft.com/l/channel/{{CHANNEL}}/General?groupId=23e1c*****ba568&tenantId={{TENANT}}\n")),(0,o.mdx)("p",null,"The values for the parameters are:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"tenant")," => ",(0,o.mdx)("inlineCode",{parentName:"li"},"{{TENANT}}")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"team")," => ",(0,o.mdx)("inlineCode",{parentName:"li"},"{{TEAM}}")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"channel")," => ",(0,o.mdx)("inlineCode",{parentName:"li"},"{{CHANNEL}}"))),(0,o.mdx)("blockquote",null,(0,o.mdx)("p",{parentName:"blockquote"},(0,o.mdx)("strong",{parentName:"p"},"IMPORTANT")," The team ID derived from the team's link is the same as the ID of the team's ",(0,o.mdx)("em",{parentName:"p"},"General")," channel.")),(0,o.mdx)("h3",{id:"send-message"},"Send Message"),(0,o.mdx)("p",null,"With that information handy, you are now ready to send a message to the team. In this example, we will send a message to the channel ",(0,o.mdx)("em",{parentName:"p"},"General")," for the team ",(0,o.mdx)("em",{parentName:"p"},"Sales and Marketing")," using the following PL/SQL procedure:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-sql"},"begin\n  dbms_cloud_notification.send_message(\n    provider => 'msteams'\n    , credential_name => 'TEAMS_CRED'\n    , message => '**SUCCESS!** message sent from '\n        || sys_context('USERENV','DB_NAME')\n    , params => json_object('channel' value '19%3a94d8*****d68aa%40thread.tacv2')\n  );\nend;\n/\n")),(0,o.mdx)("p",null,"You should see the message appear in Teams shortly."),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"Message from the ADB in Teams.",src:t(83137).Z,width:"2560",height:"480"})),(0,o.mdx)("p",null,"Did you see that? There's support for ",(0,o.mdx)("em",{parentName:"p"},"Markdown"),"! Bot messages support plain-text, Markdown, and XML formats as documented ",(0,o.mdx)("a",{parentName:"p",href:"https://learn.microsoft.com/microsoftteams/platform/bots/how-to/format-your-bot-messages"},"here"),"."),(0,o.mdx)("h3",{id:"send-data"},"Send Data"),(0,o.mdx)("p",null,"Next, we will attempt to query the sample data available in the ADB's ",(0,o.mdx)("inlineCode",{parentName:"p"},"SH")," schema, and then send it to the same channel in ",(0,o.mdx)("inlineCode",{parentName:"p"},"CSV")," format. Execute the following code:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-sql"},"declare\nl_sql clob := q'[select\n  p.prod_name\n  , s.quantity_sold\n  , s.amount_sold\n  , t.day_number_in_month || ' ' || t.calendar_month_name || ' '\n      || t.calendar_year as sold_on\nfrom sh.sales s\njoin sh.products p on p.prod_id = s.prod_id\njoin sh.times t on t.time_id = t.time_id\nfetch first 10 rows only]';\nbegin\n  dbms_cloud_notification.send_data(\n    provider => 'msteams'\n    , credential_name => 'TEAMS_CRED'\n    , query => l_sql\n    , params => json_object(\n                  'tenant' value '7d58a*****c60a0'\n                  , 'team' value '19%3a94d8*****d68aa%40thread.tacv2'\n                  , 'channel' value '19%3a94d8*****d68aa%40thread.tacv2'\n                  , 'title' value 'daily_sales_report'\n                  , 'type' value 'csv'\n                )\n  );\nend;\n/\n")),(0,o.mdx)("p",null,"If successful, you should see the ",(0,o.mdx)("inlineCode",{parentName:"p"},"CSV")," document link in teams."),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"Notification and link in Teams.",src:t(66215).Z,width:"2560",height:"400"})),(0,o.mdx)("p",null,"And when you click on the link, it should open the file in ",(0,o.mdx)("em",{parentName:"p"},"Microsoft Excel")," (Excel)."),(0,o.mdx)("p",null,(0,o.mdx)("img",{alt:"Results from the query in Excel.",src:t(84981).Z,width:"2560",height:"1600"})),(0,o.mdx)("h2",{id:"notable-issues"},"Notable Issues"),(0,o.mdx)("h3",{id:"version"},"Version"),(0,o.mdx)("p",null,"If you need to make changes your Teams app after it has been approved and published by the Teams administrator, you must do the following:"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Increment the version number in the app's basic information page and save it."),(0,o.mdx)("li",{parentName:"ol"},"Submit the updated app for approval."),(0,o.mdx)("li",{parentName:"ol"},"Have the Teams administrator repeat the approval process only. There should not be a need to add the app to the team again.")),(0,o.mdx)("h3",{id:"error-messages"},"Error Messages"),(0,o.mdx)("p",null,"If you have worked with an Oracle Database for a while, then it wouldn't surprise you that the error messages from the database sometimes do not represent the underlying issue well. ;-)"),(0,o.mdx)("h4",{id:"ora-20010-missing-credential-name"},"ORA-20010: Missing credential name"),(0,o.mdx)("p",null,"I came across this error in two difference scenarios. They are for when I attempted to:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"Send a message when the Teams app was not published successfully."),(0,o.mdx)("li",{parentName:"ul"},"Send a message when the Teams app was not added to the channel's tem."),(0,o.mdx)("li",{parentName:"ul"},"Send data to a channel other than the team's ",(0,o.mdx)("em",{parentName:"li"},"General")," channel.")),(0,o.mdx)("p",null,"It appears this error is returned whenever there is an error making a REST call to the ",(0,o.mdx)("em",{parentName:"p"},"Microsoft Graph")," API."),(0,o.mdx)("p",null,"The first two scenarios were easily resolved. However, I am still unable to send data to a channel, other than the team's ",(0,o.mdx)("em",{parentName:"p"},"General")," channel."),(0,o.mdx)("h4",{id:"ora-20000-cant-access-team-check-app-has-enough-permission"},"ORA-20000: Cant Access Team, Check App has enough permission"),(0,o.mdx)("p",null,"This one baffled me for a long time when I was trying to send data. In the documentation, it was stated that the value for ",(0,o.mdx)("inlineCode",{parentName:"p"},"team")," should be the ",(0,o.mdx)("inlineCode",{parentName:"p"},"teamID")," component in the team's link. However, the example code showed a value that looks a lot more like the ",(0,o.mdx)("inlineCode",{parentName:"p"},"groupid"),". As it turns out, this isn't a ",(0,o.mdx)("em",{parentName:"p"},"permissions")," issue, but rather, I had supplied the wrong value for ",(0,o.mdx)("inlineCode",{parentName:"p"},"team"),", and thus the internal ID for the team could not be found when the ",(0,o.mdx)("em",{parentName:"p"},"Microsoft Bot")," API was queried."),(0,o.mdx)("h4",{id:"ora-20000-cant-access-channel-check-app-has-enough-permission"},"ORA-20000: Cant Access Channel, Check App has enough permission"),(0,o.mdx)("p",null,"Similar to the previous error message, you might get this error when an incorrect ",(0,o.mdx)("inlineCode",{parentName:"p"},"channel")," identifier is provided."),(0,o.mdx)("h2",{id:"summary"},"Summary"),(0,o.mdx)("p",null,"There are countless use cases where developers might want to send notifications or data to users, whether it is through emails or a collaboration platform like Slack and Microsoft Teams. For example, notifying users involved in a business workflow for follow up action, sending daily reports to the C-suites, and more. Again, in Oracle APEX, we already have these capabilities by using either ",(0,o.mdx)("inlineCode",{parentName:"p"},"APEX_MAIL")," to send emails, or ",(0,o.mdx)("inlineCode",{parentName:"p"},"APEX_WEB_SERVICE")," to call webhooks and REST APIs. However, when working in an ADB, this provides yet another convenience method to perform the same task."),(0,o.mdx)("p",null,"With regards to sending messages, I had wondered about why the development team might have chosen to implement the messaging using a bot as oppose to the simpler webhook interface. I found this ",(0,o.mdx)("a",{parentName:"p",href:"https://learn.microsoft.com/microsoftteams/platform/webhooks-and-connectors/what-are-webhooks-and-connectors"},"article")," that listed this as a comparison between the two approaches:"),(0,o.mdx)("blockquote",null,(0,o.mdx)("p",{parentName:"blockquote"},"A notification bot works as a Teams application. You can define your business logic to process data and show data in a customized format.")),(0,o.mdx)("p",null,'With the added ability to generate and send data files, I can see why they opted to choose to implement the functionality using a bot. Further, wearing an "admin" hat, I would be more comfortable having a streamlined process for managing access to Teams and the associated resources in Microsoft 365 tenancy.'),(0,o.mdx)("p",null,'The team behind the Oracle Autonomous Database product is constantly working on new features to enhance the user/developer experience, and this is one of them! We can only hope that these "dbms_cloud"-type packages find their way quickly to the ',(0,o.mdx)("em",{parentName:"p"},"Oracle Base Database")," service and on-premise installations."),(0,o.mdx)("p",null,"I hope this article helps you to use this new feature and skip the few pain points that I had experienced getting it going!"))}p.isMDXComponent=!0},7283:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/adb-new-features-alert-72ffee96d7288cea1c4da967cba9d29a.png"},33117:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/azuread-api-permissions-and-grant-consent-9224d0cdecda0c1c5800bff09d570408.png"},856:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/bot-id-09b7f7e1f84ed2eb3ad1b8f874430098.png"},52995:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/bot-secret-f52cca82f1b99a6119be638a07d54996.png"},84981:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/received-data-34cdb2d1f5811d4e2bec3d1e0bfd9b0d.png"},61868:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/teams-admin-add-app-to-team-8fe9547c5239cb9b313a162abe24171e.png"},2396:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/teams-admin-manage-apps-ae449a9cf3398cc0b6e275dd03aad8e4.png"},25196:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/teams-admin-publish-app-f9175381ea28d34f25b819841f9e6bb6.png"},8816:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/teams-app-basic-information-d36beebfe28554eb65c36f3d20df8c20.png"},71859:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/teams-app-bot-feature-configuration-03776b969a3614c531b5ea78ae29d6b7.png"},20606:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/teams-app-features-a95fb7715f6b15faf321fd2f4e561e5a.png"},66215:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/teams-data-received-cc65248db9de2b0cb4391a48b799a57c.png"},83137:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/teams-message-received-0768213def54d940a87c2143071d9c79.png"},34832:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/teams-team-apps-d7610f9422306123f8e92879610a433f.png"}}]);