"use strict";(self.webpackChunknewsite=self.webpackChunknewsite||[]).push([[11443],{3905:(e,t,n)=>{n.r(t),n.d(t,{MDXContext:()=>s,MDXProvider:()=>c,mdx:()=>g,useMDXComponents:()=>d,withMDXComponents:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o.apply(this,arguments)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),m=function(e){return function(t){var n=d(t.components);return a.createElement(e,o({},t,{components:n}))}},d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},f=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),m=d(n),c=r,u=m["".concat(i,".").concat(c)]||m[c]||h[c]||o;return n?a.createElement(u,p(p({ref:t},s),{},{components:n})):a.createElement(u,p({ref:t},s))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=f;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p[u]="string"==typeof e?e:r,i[1]=p;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},94054:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>p,toc:()=>s});var a=n(87462),r=(n(67294),n(3905));const o={title:"Preview PDF Uploads in an APEX App (Cross-post)",tags:["orclapex","pdf","preview","viewer","demo"],categories:["Technology","Programming","Oracle Application Express"],slug:"id/1722",authors:["fuzziebrain"],date:new Date("2018-10-27T12:13:40.000Z")},i=void 0,p={permalink:"/content/id/1722",source:"@site/posts/preview-pdf-uploads-in-an-apex-app-cross-post/index.md",title:"Preview PDF Uploads in an APEX App (Cross-post)",description:"1280 720 Photo by Kaleidico",date:"2018-10-27T12:13:40.000Z",formattedDate:"October 27, 2018",tags:[{label:"orclapex",permalink:"/content/tags/orclapex"},{label:"pdf",permalink:"/content/tags/pdf"},{label:"preview",permalink:"/content/tags/preview"},{label:"viewer",permalink:"/content/tags/viewer"},{label:"demo",permalink:"/content/tags/demo"}],readingTime:2.375,hasTruncateMarker:!0,authors:[{name:"Adrian Png",title:"Senior Cloud Solutions Architect @ Insum",url:"https://github.com/fuzziebrain",imageURL:"https://github.com/fuzziebrain.png",key:"fuzziebrain"}],frontMatter:{title:"Preview PDF Uploads in an APEX App (Cross-post)",tags:["orclapex","pdf","preview","viewer","demo"],categories:["Technology","Programming","Oracle Application Express"],slug:"id/1722",authors:["fuzziebrain"],date:"2018-10-27T12:13:40.000Z"},prevItem:{title:"For Your Eyes Only - Redact to Protect",permalink:"/content/id/1723"},nextItem:{title:"Protect Your Data with Transparent Data Encryption",permalink:"/content/id/1721"}},l={authorsImageUrls:[void 0]},s=[{value:"Demo Application",id:"demo-application",level:2},{value:"The Recipe",id:"the-recipe",level:2}],m={toc:s};function d(e){let{components:t,...o}=e;return(0,r.mdx)("wrapper",(0,a.Z)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"1280 720 Photo by Kaleidico",src:n(1679).Z,width:"1280",height:"720"})),(0,r.mdx)("p",null,"Came across an interesting ",(0,r.mdx)("a",{parentName:"p",href:"https://stackoverflow.com/questions/53003083/oracle-apex-pdf-viewer"},"question")," on {% fab stack-overflow %} stack",(0,r.mdx)("strong",{parentName:"p"},"overflow")," this morning, so I thought I'd give it a shot. Turned out to be an exciting morning of learning and a pretty lengthy response that I thought I'd cross-post to keep a copy for myself. If you have any suggestions for improvement, please feel free to contribute to the thread. Thanks!"),(0,r.mdx)("h2",{id:"demo-application"},"Demo Application"),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"Link:")," ",(0,r.mdx)("a",{parentName:"p",href:"https://apex.oracle.com/pls/apex/f?p=34781"},"https://apex.oracle.com/pls/apex/f?p=34781")),(0,r.mdx)("blockquote",null,(0,r.mdx)("p",{parentName:"blockquote"},"Username: demo\nPassword: demo")),(0,r.mdx)("h2",{id:"the-recipe"},"The Recipe"),(0,r.mdx)("p",null,"This uses the ",(0,r.mdx)("a",{parentName:"p",href:"https://mozilla.github.io/pdf.js/"},"PDF.js")," project by Mozilla. Here's a quick recipe of what you may need."),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},"Create a File Browse page item and set the Storage Type to ",(0,r.mdx)("inlineCode",{parentName:"li"},"Table APEX_APPLICATION_TEMP_FILES"),"."),(0,r.mdx)("li",{parentName:"ol"},"Create a page button to submit the page."),(0,r.mdx)("li",{parentName:"ol"},"Create a Classic Report region and enter the following query:")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"select\n    id\n    , filename\nfrom apex_application_temp_files\nwhere application_id = :APP_ID\n")),(0,r.mdx)("ol",{start:4},(0,r.mdx)("li",{parentName:"ol"},"Add a virtual column and set the HTML Expression:")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-html"},'        <button type="button" class="btn-preview-pdf" data-id="#ID#">Preview</button>\n')),(0,r.mdx)("ol",{start:5},(0,r.mdx)("li",{parentName:"ol"},"Create a region and enter the following in the Source:")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-html"},'<canvas id="preview-pane"></canvas>\n')),(0,r.mdx)("ol",{start:6},(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Create a Click dynamic action.\na. Set the selection Type to ",(0,r.mdx)("inlineCode",{parentName:"p"},"jQuery Selector"),".\nb. Enter the jQuery Selector ",(0,r.mdx)("inlineCode",{parentName:"p"},".btn-preview-pdf"),".")),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Add a ",(0,r.mdx)("inlineCode",{parentName:"p"},"Execute JavaScript Code")," action with the following JS code (check out the ",(0,r.mdx)("a",{parentName:"p",href:"https://mozilla.github.io/pdf.js/examples/"},"examples")," from the PDF.js website for more details on what the code does):"))),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-javascript"},"var fileId = $(this.triggeringElement).data('id');\nvar docUrl = 'f?p=&APP_ID.:0:&APP_SESSION.:APPLICATION_PROCESS=DOWNLOADPDF:::FILE_ID:' + fileId;\nvar previewPane = this.affectedElements[0];\n\n// from PDF.js examples\npdfjsLib.getDocument(docUrl).then(function(pdf) {\n    var pageNumber = 1;\n    pdf.getPage(pageNumber).then(function(page) {\n        console.log('Page loaded');\n\n        var scale = 1.5;\n        var viewport = page.getViewport(scale);\n\n        // Prepare canvas using PDF page dimensions\n        var canvas = previewPane;\n        var context = canvas.getContext('2d');\n        canvas.height = viewport.height;\n        canvas.width = viewport.width;\n\n        // Render PDF page into canvas context\n        var renderContext = {\n            canvasContext: context,\n            viewport: viewport\n        };\n        var renderTask = page.render(renderContext);\n        renderTask.then(function () {\n            console.log('Page rendered');\n        });\n    })\n}, function(reason) {\n    console.error(reason);\n});\n")),(0,r.mdx)("ol",{start:8},(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"For the action, also set the Affected Elements:\na. Selection Type: ",(0,r.mdx)("inlineCode",{parentName:"p"},"jQuery Selector"),"\nb. jQuery Selector: ",(0,r.mdx)("inlineCode",{parentName:"p"},"#preview-pane"))),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Follow Joel Kallman's ",(0,r.mdx)("a",{parentName:"p",href:"https://joelkallman.blogspot.com/2014/03/yet-another-post-how-to-link-to.html"},"post")," on creating a link to download a file. You will need an Application Process (",(0,r.mdx)("inlineCode",{parentName:"p"},"DOWNLOADPDF"),") and an Application Item (",(0,r.mdx)("inlineCode",{parentName:"p"},"FILE_ID"),") The modified code for the Application Process ",(0,r.mdx)("inlineCode",{parentName:"p"},"DOWNLOADPDF")," looks like this:"))),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},"begin\n    for file in (select *\n                from apex_application_temp_files\n                where id = :FILE_ID) loop\n        --\n        sys.htp.init;\n        sys.owa_util.mime_header( file.mime_type, FALSE );\n        sys.htp.p('Content-length: ' || sys.dbms_lob.getlength( file.blob_content));\n        sys.htp.p('Content-Disposition: attachment; filename=\"' || file.filename || '\"' );\n        sys.htp.p('Cache-Control: max-age=3600');\n        sys.owa_util.http_header_close;\n        sys.wpg_docload.download_file( file.blob_content );\n\n        apex_application.stop_apex_engine;\n    end loop;\nend;\n")),(0,r.mdx)("ol",{start:10},(0,r.mdx)("li",{parentName:"ol"},"Almost missed this out. On the Page Attributes, set the JavaScript File URLs to any of the CDNs ",(0,r.mdx)("a",{parentName:"li",href:"https://mozilla.github.io/pdf.js/getting_started/"},"listed"),". For example:")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-html"},"//cdnjs.cloudflare.com/ajax/libs/pdf.js/2.0.550/pdf.min.js\n")),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"Note")," that this is a very basic prototype. The preview only allows you to view the first page. You will need to figure out the ",(0,r.mdx)("a",{parentName:"p",href:"https://mozilla.github.io/pdf.js/api/draft/index.html"},"API")," and then do the necessary to allow multipage viewing."))}d.isMDXComponent=!0},1679:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/kaleidico-754509-unsplash_1280x720-34aaa6ad8132f03411b268baf3be3199.jpg"}}]);