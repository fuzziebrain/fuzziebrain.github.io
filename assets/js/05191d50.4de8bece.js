"use strict";(self.webpackChunknewsite=self.webpackChunknewsite||[]).push([[7850],{34206:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var s=n(85893),a=n(11151);const o={title:"Use Package DBMS_CLOUD_REPO with GitHub",tags:["devops","plsql","autonomous database","repository","github","dbms_cloud_repo"],last_update:{date:new Date("2023-01-22T22:30:00.000Z"),author:"Adrian Png"}},i="Use Package DBMS_CLOUD_REPO with GitHub",r={id:"oracle-cloud/devops/use-package-dbms_cloud_repo-with-github",title:"Use Package DBMS_CLOUD_REPO with GitHub",description:"The Oracle Autonomous Database (ADB) includes a package named DBMSCLOUDREPO for developers, release managers, and database administrators to work with code repositories such as GitHub, AWS Code Commit, and Azure Repos.",source:"@site/notes/oracle-cloud/devops/use-package-dbms_cloud_repo-with-github.md",sourceDirName:"oracle-cloud/devops",slug:"/oracle-cloud/devops/use-package-dbms_cloud_repo-with-github",permalink:"/tech-tnt/oracle-cloud/devops/use-package-dbms_cloud_repo-with-github",draft:!1,unlisted:!1,tags:[{label:"devops",permalink:"/tech-tnt/tags/devops"},{label:"plsql",permalink:"/tech-tnt/tags/plsql"},{label:"autonomous database",permalink:"/tech-tnt/tags/autonomous-database"},{label:"repository",permalink:"/tech-tnt/tags/repository"},{label:"github",permalink:"/tech-tnt/tags/github"},{label:"dbms_cloud_repo",permalink:"/tech-tnt/tags/dbms-cloud-repo"}],version:"current",lastUpdatedBy:"Adrian Png",lastUpdatedAt:1674426600,formattedLastUpdatedAt:"Jan 22, 2023",frontMatter:{title:"Use Package DBMS_CLOUD_REPO with GitHub",tags:["devops","plsql","autonomous database","repository","github","dbms_cloud_repo"],last_update:{date:"2023-01-22T22:30:00.000Z",author:"Adrian Png"}},sidebar:"tutorialSidebar",previous:{title:"DevOps",permalink:"/tech-tnt/category/devops"}},c={},l=[{value:"Task 1 - Create a GitHub Personal Access Token (PAT)",id:"task-1---create-a-github-personal-access-token-pat",level:2},{value:"Task 2 - Store PAT in a Cloud Service Credential",id:"task-2---store-pat-in-a-cloud-service-credential",level:2},{value:"Task 3 - Check Access to Repository",id:"task-3---check-access-to-repository",level:2},{value:"Task 4 - Export Schema Objects to Repository",id:"task-4---export-schema-objects-to-repository",level:2},{value:"Task 5 - Run SQL Code from Repository",id:"task-5---run-sql-code-from-repository",level:2},{value:"References",id:"references",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"use-package-dbms_cloud_repo-with-github",children:"Use Package DBMS_CLOUD_REPO with GitHub"}),"\n",(0,s.jsxs)(t.p,{children:["The Oracle Autonomous Database (ADB) includes a package named ",(0,s.jsx)(t.code,{children:"DBMS_CLOUD_REPO"})," for developers, release managers, and database administrators to work with code repositories such as ",(0,s.jsx)(t.a,{href:"https://github.com",children:"GitHub"}),", ",(0,s.jsx)(t.a,{href:"https://aws.amazon.com/codecommit/",children:"AWS Code Commit"}),", and ",(0,s.jsx)(t.a,{href:"https://azure.microsoft.com/products/devops/repos",children:"Azure Repos"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"Using this package, you may perform actions such as:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Listing and managing repositories."}),"\n",(0,s.jsx)(t.li,{children:"List, commit to, and manage code on the repository."}),"\n",(0,s.jsx)(t.li,{children:"Export database schemas and objects directly to the repository."}),"\n",(0,s.jsx)(t.li,{children:"Checkout and execute SQL statements from files committed to the repository."}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["In this ",(0,s.jsx)(t.em,{children:"Tech TnT"})," article, we will configure an ADB to interact with a private GitHub repository to:"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Backup by exporting table, view, and package definitions from the database."}),"\n",(0,s.jsx)(t.li,{children:"Create a table using a SQL script from the repository."}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"task-1---create-a-github-personal-access-token-pat",children:"Task 1 - Create a GitHub Personal Access Token (PAT)"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Login to GitHub account."}),"\n",(0,s.jsxs)(t.li,{children:["Click your user profile image on the top-right to reveal the dropdown menu, and then click ",(0,s.jsx)(t.em,{children:"Settings"}),".",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(t.img,{alt:"Navigate to settings.",src:n(3828).Z+"",width:"200",height:"514"})]}),"\n",(0,s.jsxs)(t.li,{children:["On the next page, scroll down, and then click ",(0,s.jsx)(t.em,{children:"Developer Settings"})," at the bottom of menu on the left-side of the page.",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(t.img,{alt:"Navigate to developer settings.",src:n(89892).Z+"",width:"200",height:"350"})]}),"\n",(0,s.jsxs)(t.li,{children:["On the developer settings page, expand the dropdown ",(0,s.jsx)(t.em,{children:"Personal access tokens"}),", and then click ",(0,s.jsx)(t.em,{children:"Fine-grained tokens"}),".",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(t.img,{alt:"Select fine-grained tokens.",src:n(51842).Z+"",width:"350",height:"286"})]}),"\n",(0,s.jsxs)(t.li,{children:["Click the button ",(0,s.jsx)(t.em,{children:"Generate new token"})," on the top-right.\n",(0,s.jsx)(t.img,{alt:"Click the button generate new token.",src:n(23803).Z+"",width:"2232",height:"368"})]}),"\n",(0,s.jsxs)(t.li,{children:["Provide a name and expiry date. Include a description if possible.\n",(0,s.jsx)(t.img,{alt:"Provide name, expiration, and preferably, a description.",src:n(59538).Z+"",width:"2278",height:"1168"})]}),"\n",(0,s.jsxs)(t.li,{children:["Optionally, restrict the repositories that the API has access to using this PAT.\n",(0,s.jsx)(t.img,{alt:"Optionally, restrict the repositories that the API has access to using this personal access token.",src:n(64359).Z+"",width:"1044",height:"732"})]}),"\n",(0,s.jsxs)(t.li,{children:["Allow the contents of the repository to be read and written through the GitHub API using this PAT.\n",(0,s.jsx)(t.img,{alt:"Allow read and write permissions for the repository content.",src:n(12331).Z+"",width:"1606",height:"184"})]}),"\n",(0,s.jsxs)(t.li,{children:["Review the assigned permissions and then click the button ",(0,s.jsx)(t.em,{children:"Create token"}),".\n",(0,s.jsx)(t.img,{alt:"Confirm the assigned permissions and create the token.",src:n(7331).Z+"",width:"1634",height:"806"})]}),"\n",(0,s.jsxs)(t.li,{children:["the PAT is displayed only once after it is created. Copy the value and store it in a safe place.\n",(0,s.jsx)(t.img,{alt:"Copy the personal access token as it will only be displayed once.",src:n(26913).Z+"",width:"2316",height:"644"})]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"task-2---store-pat-in-a-cloud-service-credential",children:"Task 2 - Store PAT in a Cloud Service Credential"}),"\n",(0,s.jsxs)(t.p,{children:["The GitHub personal access token (PAT) generated in the previous task should be stored as a ",(0,s.jsx)(t.em,{children:"cloud service credential"})," in the ADB. This is performed using the ",(0,s.jsx)(t.code,{children:"DBMS_CLOUD.CREATE_CREDENTIAL"})," procedure."]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"List existing credentials in the ADB:"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"select *\nfrom user_credentials;\n"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Create a credential for GitHub using the PAT."}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"begin\n  dbms_cloud.create_credential(\n    credential_name => 'GITHUB_CRED'\n    , username => 'mygithub@email.com'\n    , password => 'github_pat_...'\n  );\nend;\n/\n"})}),"\n",(0,s.jsx)(t.h2,{id:"task-3---check-access-to-repository",children:"Task 3 - Check Access to Repository"}),"\n",(0,s.jsx)(t.p,{children:"Next, validate the cloud service credential created in the previous task by executing the following code:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"column name format a50;\nvar repo_handle clob;\n\nbegin\n  :repo_handle := dbms_cloud_repo.init_github_repo(\n    credential_name => 'GITHUB_CRED'\n    , repo_name => 'myrepo'\n    , owner => 'mygithubaccount'\n  );\nend;\n/\n\nselect name from dbms_cloud_repo.list_repositories(:repo_handle);\n"})}),"\n",(0,s.jsx)(t.p,{children:"If the credential setup was successful, a list of repositories that the PAT has access will be displayed."}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsxs)(t.p,{children:["The above code snippet can be executed in ",(0,s.jsx)(t.em,{children:"SQLcl"}),", ",(0,s.jsx)(t.em,{children:"SQL*Plus"}),", or ",(0,s.jsx)(t.em,{children:"SQL Developer"}),". However, when executing it in SQL Developer, execute the entire snippet as a script."]})}),"\n",(0,s.jsx)(t.h2,{id:"task-4---export-schema-objects-to-repository",children:"Task 4 - Export Schema Objects to Repository"}),"\n",(0,s.jsxs)(t.p,{children:["With the credential setup completed and validated, you may now use the ",(0,s.jsx)(t.code,{children:"DBMS_CLOUD_REPO"})," subprograms to export database objects to the GitHub repository. Execute the PL/SQL code below to iterate through the schema's tables, views, and the specifications and body of all packages, using the ",(0,s.jsx)(t.code,{children:"DBMS_CLOUD_REPO.EXPORT_OBJECT"})," procedure. The DDL of each object type will upload the code in an appropriate subdirectory name. Amend the commit message, author, and email as required."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"declare\n  l_repo_handle clob;\nbegin\n  l_repo_handle := dbms_cloud_repo.init_github_repo(\n    credential_name => 'GITHUB_CRED'\n    , owner => 'mygithubaccount'\n    , repo_name => 'myrepo'\n  );\n\n  for obj in (\n    select *\n    from user_objects\n    where object_type in ('TABLE', 'VIEW', 'PACKAGE', 'PACKAGE BODY')\n  ) loop\n    dbms_cloud_repo.export_object(\n      repo => l_repo_handle\n      , file_path =>\n          case obj.object_type\n            when 'TABLE'\n              then 'models/' || lower(obj.object_name) || '.sql'\n            when 'VIEW'\n              then 'views/' || lower(obj.object_name) || '.sql'\n            when 'PACKAGE'\n              then 'packages/' || lower(obj.object_name) || '.pks'\n            when 'PACKAGE BODY'\n              then 'packages/' || lower(obj.object_name) || '.pkb'\n          end\n      , object_type =>\n          case obj.object_type\n            when 'TABLE' then 'TABLE'\n            when 'VIEW' then 'VIEW'\n            when 'PACKAGE' then 'PACKAGE_SPEC'\n            when 'PACKAGE BODY' then 'PACKAGE_BODY'\n          end\n      , object_name => obj.object_name\n      , object_schema => user\n      , branch_name => 'main'\n      , commit_details => json_object(\n          'message' value 'DBMS_CLOUD_REPO commit'\n          , 'author' value 'Name Used for Commits'\n          , 'email' value 'my.commit.address@email.com'\n        )\n      , append => false\n    );\n  end loop;\nend;\n/\n"})}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsxs)(t.p,{children:["Alternatively, use the ",(0,s.jsx)(t.a,{href:"https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/DBMS_METADATA.html#GUID-A4683EEE-6F54-4081-B7BF-1496096675FA",children:(0,s.jsx)(t.code,{children:"DBMS_METADATA.GET_DDL"})})," procedure for fine-grain control of the data definition language (DDL) code generated, and then commit the code using the ",(0,s.jsx)(t.code,{children:"DBMS_CLOUD_REPO.PUT_FILE"})," procedure."]})}),"\n",(0,s.jsx)(t.h2,{id:"task-5---run-sql-code-from-repository",children:"Task 5 - Run SQL Code from Repository"}),"\n",(0,s.jsxs)(t.p,{children:["In the final example, the procedure will checkout the file specified in the ",(0,s.jsx)(t.code,{children:"DBMS_CLOUD_REPO.INSTALL_FILE"})," procedure's ",(0,s.jsx)(t.code,{children:"file_path"})," parameter and execute in the database."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"declare\n  l_repo_handle clob;\nbegin\n  l_repo_handle := dbms_cloud_repo.init_github_repo(\n    credential_name => 'GITHUB_CRED'\n    , owner => 'mygithubaccount'\n    , repo_name => 'myrepo'\n  );\n\n  dbms_cloud_repo.install_file(\n    repo => l_repo_handle\n    , file_path => 'models/mytable.sql',\n    stop_on_error => true\n  );\nend;\n/\n"})}),"\n",(0,s.jsxs)(t.p,{children:["If the file ",(0,s.jsx)(t.code,{children:"models/mytable.sql"})," creates a table named ",(0,s.jsx)(t.code,{children:"MYTABLE"}),", validate that it was successfully created in the database."]}),"\n",(0,s.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token",children:"GitHub Docs - Creating a personal access token"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://docs.oracle.com/en/cloud/paas/autonomous-database/adbsa/dbms-cloud-repo-package.html",children:"Oracle Documentation - DBMS_CLOUD_REPO package."})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/DBMS_METADATA.html",children:"Oracle Documentation - DBMS_METADATA package."})}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},12331:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/allow-content-read-and-write-472898e74eece16f73513d2fd03c1352.png"},23803:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/click-generate-new-token-d07b1d5fbc09b50b27cd3334b4cb3712.png"},7331:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/confirm-permissions-and-create-token-e0175cb6759071d1280132e6c731f250.png"},26913:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/copy-personal-access-token-cd655520cf6e2eb693b05382363e377a.png"},89892:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/navigate-to-developer-settings-df2ee33788c199c8f6f9bda210cf5694.png"},3828:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/navigate-to-settings-5190896ce22d13539be966f917027afa.png"},64359:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/optionally-restrict-repositories-6d8dfd5c0176be1f9b5567c301c90e59.png"},59538:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/provide-name-description-and-expiry-d0db206c9ae8649aa5ac215c897f1f4d.png"},51842:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/select-fine-grained-tokens-e7a4d9ba6fabfd66bab4c60f627ac27c.png"},11151:(e,t,n)=>{n.d(t,{Z:()=>r,a:()=>i});var s=n(67294);const a={},o=s.createContext(a);function i(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);