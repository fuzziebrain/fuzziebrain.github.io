"use strict";(self.webpackChunknewsite=self.webpackChunknewsite||[]).push([[91682],{3905:(e,t,a)=>{a.r(t),a.d(t,{MDXContext:()=>d,MDXProvider:()=>p,mdx:()=>f,useMDXComponents:()=>c,withMDXComponents:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o.apply(this,arguments)}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var d=n.createContext({}),m=function(e){return function(t){var a=c(t.components);return n.createElement(e,o({},t,{components:a}))}},c=function(e){var t=n.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(d.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},b=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),m=c(a),p=r,u=m["".concat(l,".").concat(p)]||m[p]||h[p]||o;return a?n.createElement(u,s(s({ref:t},d),{},{components:a})):n.createElement(u,s({ref:t},d))}));function f(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,l=new Array(o);l[0]=b;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[u]="string"==typeof e?e:r,l[1]=s;for(var d=2;d<o;d++)l[d]=a[d];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}b.displayName="MDXCreateElement"},36281:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var n=a(87462),r=(a(67294),a(3905));const o={title:"Running ORDS Against the Autonomous Database - Part 2",tags:["ords","rest","orclapex","autonomous","database","load balancer"],slug:"id/2005",authors:["fuzziebrain"],categories:["Technology","Infrastructure","Oracle Cloud"],date:new Date("2020-07-01T20:46:45.000Z")},l=void 0,s={permalink:"/content/id/2005",source:"@site/posts/running-ords-against-the-autonomous-database-part-2/index.md",title:"Running ORDS Against the Autonomous Database - Part 2",description:"Old pipes and valves",date:"2020-07-01T20:46:45.000Z",formattedDate:"July 1, 2020",tags:[{label:"ords",permalink:"/content/tags/ords"},{label:"rest",permalink:"/content/tags/rest"},{label:"orclapex",permalink:"/content/tags/orclapex"},{label:"autonomous",permalink:"/content/tags/autonomous"},{label:"database",permalink:"/content/tags/database"},{label:"load balancer",permalink:"/content/tags/load-balancer"}],readingTime:6.265,hasTruncateMarker:!0,authors:[{name:"Adrian Png",title:"Senior Cloud Solutions Architect @ Insum",url:"https://github.com/fuzziebrain",imageURL:"https://github.com/fuzziebrain.png",key:"fuzziebrain"}],frontMatter:{title:"Running ORDS Against the Autonomous Database - Part 2",tags:["ords","rest","orclapex","autonomous","database","load balancer"],slug:"id/2005",authors:["fuzziebrain"],categories:["Technology","Infrastructure","Oracle Cloud"],date:"2020-07-01T20:46:45.000Z"},prevItem:{title:"Keep Your APEX Images Updated",permalink:"/content/id/2006"},nextItem:{title:"Running ORDS Against the Autonomous Database",permalink:"/content/id/2004"}},i={authorsImageUrls:[void 0]},d=[{value:"Load Balancers",id:"load-balancers",level:2},{value:"Backend Sets",id:"backend-sets",level:2},{value:"Hostnames",id:"hostnames",level:2},{value:"SSL/TLS Certificates",id:"ssltls-certificates",level:2},{value:"Listeners",id:"listeners",level:2},{value:"Other Resources",id:"other-resources",level:2},{value:"Final Step",id:"final-step",level:2}],m={toc:d};function c(e){let{components:t,...o}=e;return(0,r.mdx)("wrapper",(0,n.Z)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Old pipes and valves",src:a(14419).Z,width:"3766",height:"2118"})),(0,r.mdx)("p",null,"In my ",(0,r.mdx)("a",{parentName:"p",href:"/content/id/2004/"},"previous post"),", we looked at installing and configuring ",(0,r.mdx)("a",{parentName:"p",href:"https://www.oracle.com/ca-en/database/technologies/appdev/rest.html"},"Oracle REST Data Services")," (ORDS) and have it work with ",(0,r.mdx)("a",{parentName:"p",href:"https://apex.oracle.com"},"Oracle Application Express")," (APEX) that comes preinstalled with every ",(0,r.mdx)("a",{parentName:"p",href:"https://www.oracle.com/database/what-is-autonomous-database.html"},"Oracle Autonomous Database")," (ADB). Like APEX, ORDS is also included as a feature of the ADB. However, there are certain situations where you might like to manage your own instance of ORDS."),(0,r.mdx)("p",null,"Three key reasons stand out for me:"),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},"Using my own domain for my APEX applications."),(0,r.mdx)("li",{parentName:"ol"},"Managing the number of database connections consumed by ORDS for my Always Free ADB that comes with a limit of 20 concurrent database sessions."),(0,r.mdx)("li",{parentName:"ol"},'Restricting "direct" access to the ADB, for example, to connect to the database using external tools like ',(0,r.mdx)("a",{parentName:"li",href:"https://www.oracle.com/database/technologies/appdev/sqldeveloper-landing.html"},"SQL Developer and SQLcl"),".")),(0,r.mdx)("p",null,"The figure below depicts the topology that I will build for my APEX applications."),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Planned topology",src:a(20482).Z,width:"705",height:"335"})),(0,r.mdx)("p",null,"Note that I chose a single subnet for the Load Balancer and Compute. The latter may be deployed in a separate subnet for further isolation."),(0,r.mdx)("h2",{id:"load-balancers"},"Load Balancers"),(0,r.mdx)("p",null,"Under the ",(0,r.mdx)("a",{parentName:"p",href:"https://oracle.com/cloud/free"},"Oracle Cloud Free Tier")," offering, users are provided with one ",(0,r.mdx)("em",{parentName:"p"},"Always Free")," load balancer. It has a special bandwidth size called ",(0,r.mdx)("em",{parentName:"p"},"Micro")," and is limited to a maximum of 10 Mbps."),(0,r.mdx)("p",null,"Go to the Load Balancers page. You will find it under the Networks menu item. Click on the blue ",(0,r.mdx)("em",{parentName:"p"},"Create Load Balancer")," button to begin."),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Create Load Balancer Wizard",src:a(84948).Z,width:"1280",height:"800"})),(0,r.mdx)("p",null,"In the first step, do the following:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"Provide a suitable name."),(0,r.mdx)("li",{parentName:"ul"},"Set the visibility type to ",(0,r.mdx)("em",{parentName:"li"},"Public"),"."),(0,r.mdx)("li",{parentName:"ul"},"Set the total bandwidth to ",(0,r.mdx)("em",{parentName:"li"},"Micro"),". Note that this size is not selectable if you have already created one, or are not in your Oracle Cloud Infrastructure (OCI) home region."),(0,r.mdx)("li",{parentName:"ul"},"Select the appropriate Virtual Cloud Network (VCN) and subnet that the load balancer should be placed in. Make sure that it is setup as a public network, an Internet Gateway and network route rules for bidirectional Internet traffic.")),(0,r.mdx)("p",null,"In the next step, leave the default settings. However, on the third and final step, change the listener to listen for HTTP traffic."),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Create Load Balancer Wizard - Final Step",src:a(35673).Z,width:"1280",height:"800"})),(0,r.mdx)("p",null,"Click on ",(0,r.mdx)("em",{parentName:"p"},"Submit")," to create the load balancer. A Listener and Backend Set is also created in the process, but we should delete them both once the load balancer is up."),(0,r.mdx)("p",null,"Once created, the Load Balancer Details page will display the Reserved Public IP address it has been assigned with. Use this to update your DNS records."),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Load Balancer Details page",src:a(67627).Z,width:"1280",height:"800"})),(0,r.mdx)("blockquote",null,(0,r.mdx)("p",{parentName:"blockquote"},"Remember to delete the listener and backend set created by default.")),(0,r.mdx)("h2",{id:"backend-sets"},"Backend Sets"),(0,r.mdx)("p",null,"Next, create the backend set that includes the Compute instance hosting ORDS. On the left side of the Load Balancer Details page, you will find a list of Resources that can be managed. Click on ",(0,r.mdx)("em",{parentName:"p"},"Backend Sets")," and then click on the blue ",(0,r.mdx)("em",{parentName:"p"},"Create Backend Set")," button to launch the wizard."),(0,r.mdx)("p",null,"Provide a suitable name and then leave the default values for ",(0,r.mdx)("em",{parentName:"p"},"Traffic Distribution Policy")," and ",(0,r.mdx)("em",{parentName:"p"},"Session Persistence"),". Under Health Check, set the following:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"Protocol")," - HTTP"),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"Port")," - 8080"),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"URL Path")," - /i/19.2.0.00.18/apex_version.txt")),(0,r.mdx)("p",null,"After the backend set is created successfully, click on its name and add backends. You can access the list of backends from the Resources menu on the left of the Backend Set Information page."),(0,r.mdx)("p",null,"To begin, click the blue ",(0,r.mdx)("em",{parentName:"p"},"Add Backends")," button and then select the Compute instance that is hosting ORDS. Be sure to change the port number to ",(0,r.mdx)("inlineCode",{parentName:"p"},"8080"),"."),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Add Backends Modal Dialog",src:a(52663).Z,width:"1280",height:"800"})),(0,r.mdx)("p",null,"For traffic to flow between the load balancer and backends, appropriate ingress and egress security list rules are required. You may do this manually, but for convenience, you can have the wizard perform these tasks automaticallly."),(0,r.mdx)("p",null,"Click the ",(0,r.mdx)("em",{parentName:"p"},"Add")," button to complete the process."),(0,r.mdx)("h2",{id:"hostnames"},"Hostnames"),(0,r.mdx)("p",null,"This is an optional resource but is simple to create. Simply provide a name and the URL that will be associated with the listener."),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Add Hostname Modal Dialog",src:a(80901).Z,width:"1280",height:"800"})),(0,r.mdx)("h2",{id:"ssltls-certificates"},"SSL/TLS Certificates"),(0,r.mdx)("p",null,"We will want to secure our access to the APEX instance. I will not go into details now on how to obtain a valid SSL/TLS certificate. To create this resource, you should have the following:"),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},"SSL/TLS public certificate"),(0,r.mdx)("li",{parentName:"ol"},"CA certificate (while optional, I have found issues with REST clients validating with ",(0,r.mdx)("a",{parentName:"li",href:"https://letsencrypt.org/"},"Let's Encrypt")," certificates)"),(0,r.mdx)("li",{parentName:"ol"},"Private key")),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Add Certificate Modal Dialog",src:a(42126).Z,width:"1280",height:"800"})),(0,r.mdx)("blockquote",null,(0,r.mdx)("p",{parentName:"blockquote"},(0,r.mdx)("strong",{parentName:"p"},"All")," certificates and key must be in the PEM format.")),(0,r.mdx)("blockquote",null,(0,r.mdx)("p",{parentName:"blockquote"},(0,r.mdx)("em",{parentName:"p"},"Update ","[Sep 14, 2020]")),(0,r.mdx)("p",{parentName:"blockquote"},"I have made available a ",(0,r.mdx)("a",{parentName:"p",href:"https://github.com/fuzziebrain/oci-le-cert-manager"},"project")," that helps perform some of these tasks. You can read more about it in this follow-up ",(0,r.mdx)("a",{parentName:"p",href:"/content/id/2007"},"post"),".")),(0,r.mdx)("h2",{id:"listeners"},"Listeners"),(0,r.mdx)("p",null,"Create two listeners, one each for listening to secure and non-secure traffic."),(0,r.mdx)("p",null,"The HTTP listener should have the following attributes:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"A suitable name"),(0,r.mdx)("li",{parentName:"ul"},"An optional hostname"),(0,r.mdx)("li",{parentName:"ul"},"Listen using the HTTP protocol"),(0,r.mdx)("li",{parentName:"ul"},"Listen on port 80"),(0,r.mdx)("li",{parentName:"ul"},"Use SSL unchecked"),(0,r.mdx)("li",{parentName:"ul"},"The backend defined for the ORDS server selected"),(0,r.mdx)("li",{parentName:"ul"},"Default timeout of 60 seconds (or leave it blank)")),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Create Listener Modal Dialog for HTTP Protocol",src:a(3245).Z,width:"1280",height:"800"})),(0,r.mdx)("p",null,"The HTTPS listener should have the following attributes:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"A suitable name"),(0,r.mdx)("li",{parentName:"ul"},"An optional hostname"),(0,r.mdx)("li",{parentName:"ul"},"Listen using the ",(0,r.mdx)("strong",{parentName:"li"},"HTTP")," protocol"),(0,r.mdx)("li",{parentName:"ul"},"Listen on port 443"),(0,r.mdx)("li",{parentName:"ul"},"Use SSL checked"),(0,r.mdx)("li",{parentName:"ul"},"The associated certificate selected"),(0,r.mdx)("li",{parentName:"ul"},"Verify peer certificate unchecked"),(0,r.mdx)("li",{parentName:"ul"},"The backend defined for the ORDS server selected"),(0,r.mdx)("li",{parentName:"ul"},"Idle timeout set to 1800 seconds")),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Create Listener Modal Dialog for HTTPS Protocol",src:a(32806).Z,width:"1280",height:"800"})),(0,r.mdx)("blockquote",null,(0,r.mdx)("p",{parentName:"blockquote"},"The idle timeout I have suggested can be tweaked to your requirements. I have found 60 seconds to be too short for a functional APEX application. For example, file operations sometimes require a longer length of time to be completed successfully.")),(0,r.mdx)("h2",{id:"other-resources"},"Other Resources"),(0,r.mdx)("p",null,"The instructions provided in the blog post gets you a basic setup to support a standard customer-managed ORDS instance. More often than not, you will have other requirements. For example, the ",(0,r.mdx)("a",{parentName:"p",href:"https://apeks.app/sponsor-a-coin"},"APEX Challenge Coin")," website uses a path alias that links to the APEX application for submitting nominations. In web servers, these are usually addressed by creating URL rewrite rules that redirect you to the correct address. For this purpose, you may use a ",(0,r.mdx)("em",{parentName:"p"},"Rule Set")," and assign it to a listener. Here's a full list of rule types that you can create:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"Access Control"),(0,r.mdx)("li",{parentName:"ul"},"Access Method"),(0,r.mdx)("li",{parentName:"ul"},"URL Redirect"),(0,r.mdx)("li",{parentName:"ul"},"Request Header"),(0,r.mdx)("li",{parentName:"ul"},"Response Header"),(0,r.mdx)("li",{parentName:"ul"},"HTTP Header")),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Create Rule Set Modal Dialog",src:a(49498).Z,width:"1280",height:"800"})),(0,r.mdx)("p",null,"You might also serve other resources hosted on other backend servers. For example, I host some static content on the apeks.app website. For that, I run an Apache Web Server that hosts a single static HTML page. I can create Path Route Sets that will redirect the browser to the appropriate backend server based on the supplied path. Any path that starts with ",(0,r.mdx)("inlineCode",{parentName:"p"},"/i")," or ",(0,r.mdx)("inlineCode",{parentName:"p"},"/ords"),", which is used by APEX and ORDS, hands off to the backend running ORDS. The default, and so every other path, will lead to the other web server."),(0,r.mdx)("blockquote",null,(0,r.mdx)("p",{parentName:"blockquote"},(0,r.mdx)("em",{parentName:"p"},"Update ","[Sep 14, 2020]")),(0,r.mdx)("p",{parentName:"blockquote"},"Thanks to ",(0,r.mdx)("a",{parentName:"p",href:"https://disqus.com/by/disqus_RgMBmO0DI7/"},"Robert Barton")," for pointing out in the comments. I forgot to mention that once the path route set has been created, assign it to the target listener. In my case, this would be the listener with SSL enabled.")),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Create Path Route Set Modal Dialog",src:a(30863).Z,width:"1280",height:"800"})),(0,r.mdx)("h2",{id:"final-step"},"Final Step"),(0,r.mdx)("p",null,"Login to the server hosting ORDS as the ",(0,r.mdx)("em",{parentName:"p"},"opc")," user and edit the ",(0,r.mdx)("em",{parentName:"p"},"ORDS Service Script Configuration File"),":"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"sudo vi /etc/ords/ords.conf\n")),(0,r.mdx)("p",null,"Uncomment the line containing:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"JAVA_OPTIONS=-Dsecurity.forceHTTPS=true\n")),(0,r.mdx)("p",null,"Restart the ORDS service:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl restart ords\n")),(0,r.mdx)("p",null,"That's it!"))}c.isMDXComponent=!0},14419:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/pipes-5146458_1280x800-48ddbc2f929f85b87fc1aa3a601a574d.jpg"},84948:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/screen01-f41fbb5770ab6122bbac193dd1b2ca64.png"},35673:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/screen02-8bf1a871ab58f23513bacfba2b287322.png"},67627:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/screen03-95a594d6a286b314c38b53d631e5a65b.png"},52663:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/screen04-4b850f409aba608b950619904b5cf98e.png"},80901:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/screen05-caa6b21ee2438e20c3d00f68612b64d3.png"},42126:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/screen06-cda90c706659a405c784c09111c41574.png"},3245:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/screen07-510bc663de2bbf39b4497f0c5361bf16.png"},32806:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/screen08-dfb6c9eba5014540c953b0a5638c9343.png"},49498:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/screen09-239f0cedc610e731f8e3bb7d2f1b7d9b.png"},30863:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/screen10-2dba30cc746de54211a3a1c48a288b30.png"},20482:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/topology-6d1358e72c4a6f2bac7a83a107bdc6d7.png"}}]);