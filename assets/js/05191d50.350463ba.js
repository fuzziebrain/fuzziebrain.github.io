"use strict";(self.webpackChunknewsite=self.webpackChunknewsite||[]).push([[7850],{3905:(e,t,a)=>{a.r(t),a.d(t,{MDXContext:()=>c,MDXProvider:()=>m,mdx:()=>g,useMDXComponents:()=>p,withMDXComponents:()=>d});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},r.apply(this,arguments)}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var c=n.createContext({}),d=function(e){return function(t){var a=p(t.components);return n.createElement(e,r({},t,{components:a}))}},p=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(c.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},b=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(a),m=o,u=d["".concat(s,".").concat(m)]||d[m]||h[m]||r;return a?n.createElement(u,i(i({ref:t},c),{},{components:a})):n.createElement(u,i({ref:t},c))}));function g(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,s=new Array(r);s[0]=b;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[u]="string"==typeof e?e:o,s[1]=i;for(var c=2;c<r;c++)s[c]=a[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}b.displayName="MDXCreateElement"},47536:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var n=a(87462),o=(a(67294),a(3905));const r={title:"Use Package DBMS_CLOUD_REPO with GitHub",tags:["devops","plsql","autonomous database","repository","github"],authors:["fuzziebrain"],date:new Date("2023-01-22T22:20:00.000Z")},s="Use Package DBMS_CLOUD_REPO with GitHub",i={unversionedId:"oracle-cloud/devops/use-package-dbms_cloud_repo-with-github",id:"oracle-cloud/devops/use-package-dbms_cloud_repo-with-github",title:"Use Package DBMS_CLOUD_REPO with GitHub",description:"The Oracle Autonomous Database (ADB) includes a package named DBMSCLOUDREPO for developers, release managers, and database administrators to work with code repositories such as GitHub, AWS Code Commit, and Azure Repos.",source:"@site/notes/oracle-cloud/devops/use-package-dbms_cloud_repo-with-github.md",sourceDirName:"oracle-cloud/devops",slug:"/oracle-cloud/devops/use-package-dbms_cloud_repo-with-github",permalink:"/tech-tnt/oracle-cloud/devops/use-package-dbms_cloud_repo-with-github",draft:!1,tags:[{label:"devops",permalink:"/tech-tnt/tags/devops"},{label:"plsql",permalink:"/tech-tnt/tags/plsql"},{label:"autonomous database",permalink:"/tech-tnt/tags/autonomous-database"},{label:"repository",permalink:"/tech-tnt/tags/repository"},{label:"github",permalink:"/tech-tnt/tags/github"}],version:"current",frontMatter:{title:"Use Package DBMS_CLOUD_REPO with GitHub",tags:["devops","plsql","autonomous database","repository","github"],authors:["fuzziebrain"],date:"2023-01-22T22:20:00.000Z"},sidebar:"tutorialSidebar",previous:{title:"DevOps",permalink:"/tech-tnt/category/devops"}},l={},c=[{value:"Task 1 - Create a GitHub Personal Access Token (PAT)",id:"task-1---create-a-github-personal-access-token-pat",level:2},{value:"Task 2 - Store PAT in a Cloud Service Credential",id:"task-2---store-pat-in-a-cloud-service-credential",level:2},{value:"Task 3 - Check Access to Repository",id:"task-3---check-access-to-repository",level:2},{value:"Task 4 - Export Schema Objects to Repository",id:"task-4---export-schema-objects-to-repository",level:2},{value:"Task 5 - Run SQL Code from Repository",id:"task-5---run-sql-code-from-repository",level:2},{value:"References",id:"references",level:2}],d={toc:c};function p(e){let{components:t,...r}=e;return(0,o.mdx)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"use-package-dbms_cloud_repo-with-github"},"Use Package DBMS_CLOUD_REPO with GitHub"),(0,o.mdx)("p",null,"The Oracle Autonomous Database (ADB) includes a package named ",(0,o.mdx)("inlineCode",{parentName:"p"},"DBMS_CLOUD_REPO")," for developers, release managers, and database administrators to work with code repositories such as ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com"},"GitHub"),", ",(0,o.mdx)("a",{parentName:"p",href:"https://aws.amazon.com/codecommit/"},"AWS Code Commit"),", and ",(0,o.mdx)("a",{parentName:"p",href:"https://azure.microsoft.com/products/devops/repos"},"Azure Repos"),"."),(0,o.mdx)("p",null,"Using this package, you may perform actions such as:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"Listing and managing repositories."),(0,o.mdx)("li",{parentName:"ul"},"List, commit to, and manage code on the repository."),(0,o.mdx)("li",{parentName:"ul"},"Export database schemas and objects directly to the repository."),(0,o.mdx)("li",{parentName:"ul"},"Checkout and execute SQL statements from files committed to the repository.")),(0,o.mdx)("p",null,"In this ",(0,o.mdx)("em",{parentName:"p"},"Tech TnT")," article, we will configure an ADB to interact with a private GitHub repository to:"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Backup by exporting table, view, and package definitions from the database."),(0,o.mdx)("li",{parentName:"ol"},"Create a table using a SQL script from the repository.")),(0,o.mdx)("h2",{id:"task-1---create-a-github-personal-access-token-pat"},"Task 1 - Create a GitHub Personal Access Token (PAT)"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Login to GitHub account."),(0,o.mdx)("li",{parentName:"ol"},"Click your user profile image on the top-right to reveal the dropdown menu, and then click ",(0,o.mdx)("em",{parentName:"li"},"Settings"),".",(0,o.mdx)("br",null),(0,o.mdx)("img",{alt:"Navigate to settings.",src:a(3828).Z,width:"200",height:"514"})),(0,o.mdx)("li",{parentName:"ol"},"On the next page, scroll down, and then click ",(0,o.mdx)("em",{parentName:"li"},"Developer Settings")," at the bottom of menu on the left-side of the page.",(0,o.mdx)("br",null),(0,o.mdx)("img",{alt:"Navigate to developer settings.",src:a(89892).Z,width:"200",height:"350"})),(0,o.mdx)("li",{parentName:"ol"},"On the developer settings page, expand the dropdown ",(0,o.mdx)("em",{parentName:"li"},"Personal access tokens"),", and then click ",(0,o.mdx)("em",{parentName:"li"},"Fine-grained tokens"),".",(0,o.mdx)("br",null),(0,o.mdx)("img",{alt:"Select fine-grained tokens.",src:a(51842).Z,width:"350",height:"286"})),(0,o.mdx)("li",{parentName:"ol"},"Click the button ",(0,o.mdx)("em",{parentName:"li"},"Generate new token")," on the top-right.\n",(0,o.mdx)("img",{alt:"Click the button generate new token.",src:a(23803).Z,width:"2232",height:"368"})),(0,o.mdx)("li",{parentName:"ol"},"Provide a name and expiry date. Include a description if possible.\n",(0,o.mdx)("img",{alt:"Provide name, expiration, and preferably, a description.",src:a(59538).Z,width:"2278",height:"1168"})),(0,o.mdx)("li",{parentName:"ol"},"Optionally, restrict the repositories that the API has access to using this PAT.\n",(0,o.mdx)("img",{alt:"Optionally, restrict the repositories that the API has access to using this personal access token.",src:a(64359).Z,width:"1044",height:"732"})),(0,o.mdx)("li",{parentName:"ol"},"Allow the contents of the repository to be read and written through the GitHub API using this PAT.\n",(0,o.mdx)("img",{alt:"Allow read and write permissions for the repository content.",src:a(12331).Z,width:"1606",height:"184"})),(0,o.mdx)("li",{parentName:"ol"},"Review the assigned permissions and then click the button ",(0,o.mdx)("em",{parentName:"li"},"Create token"),".\n",(0,o.mdx)("img",{alt:"Confirm the assigned permissions and create the token.",src:a(7331).Z,width:"1634",height:"806"})),(0,o.mdx)("li",{parentName:"ol"},"the PAT is displayed only once after it is created. Copy the value and store it in a safe place.\n",(0,o.mdx)("img",{alt:"Copy the personal access token as it will only be displayed once.",src:a(26913).Z,width:"2316",height:"644"}))),(0,o.mdx)("h2",{id:"task-2---store-pat-in-a-cloud-service-credential"},"Task 2 - Store PAT in a Cloud Service Credential"),(0,o.mdx)("p",null,"The GitHub personal access token (PAT) generated in the previous task should be stored as a ",(0,o.mdx)("em",{parentName:"p"},"cloud service credential")," in the ADB. This is performed using the ",(0,o.mdx)("inlineCode",{parentName:"p"},"DBMS_CLOUD.CREATE_CREDENTIAL")," procedure."),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"List existing credentials in the ADB:")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-sql"},"select *\nfrom user_credentials;\n")),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Create a credential for GitHub using the PAT.")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-sql"},"begin\n  dbms_cloud.create_credential(\n    credential_name => 'GITHUB_CRED'\n    , username => 'mygithub@email.com'\n    , password => 'github_pat_...'\n  );\nend;\n/\n")),(0,o.mdx)("h2",{id:"task-3---check-access-to-repository"},"Task 3 - Check Access to Repository"),(0,o.mdx)("p",null,"Next, validate the cloud service credential created in the previous task by executing the following code:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-sql"},"column name format a50;\nvar repo_handle clob;\n\nbegin\n  :repo_handle := dbms_cloud_repo.init_github_repo(\n    credential_name => 'GITHUB_CRED'\n    , repo_name => 'myrepo'\n    , owner => 'mygithubaccount'\n  );\nend;\n/\n\nselect name from dbms_cloud_repo.list_repositories(:repo_handle);\n")),(0,o.mdx)("p",null,"If the credential setup was successful, a list of repositories that the PAT has access will be displayed."),(0,o.mdx)("admonition",{type:"note"},(0,o.mdx)("p",{parentName:"admonition"},"The above code snippet can be executed in ",(0,o.mdx)("em",{parentName:"p"},"SQLcl"),", ",(0,o.mdx)("em",{parentName:"p"},"SQL","*","Plus"),", or ",(0,o.mdx)("em",{parentName:"p"},"SQL Developer"),". However, when executing it in SQL Developer, execute the entire snippet as a script.")),(0,o.mdx)("h2",{id:"task-4---export-schema-objects-to-repository"},"Task 4 - Export Schema Objects to Repository"),(0,o.mdx)("p",null,"With the credential setup completed and validated, you may now use the ",(0,o.mdx)("inlineCode",{parentName:"p"},"DBMS_CLOUD_REPO")," subprograms to export database objects to the GitHub repository. Execute the PL/SQL code below to iterate through the schema's tables, views, and the specifications and body of all packages, using the ",(0,o.mdx)("inlineCode",{parentName:"p"},"DBMS_CLOUD_REPO.EXPORT_OBJECT")," procedure. The DDL of each object type will upload the code in an appropriate subdirectory name. Amend the commit message, author, and email as required."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-sql"},"declare\n  l_repo_handle clob;\nbegin\n  l_repo_handle := dbms_cloud_repo.init_github_repo(\n    credential_name => 'GITHUB_CRED'\n    , owner => 'mygithubaccount'\n    , repo_name => 'myrepo'\n  );\n\n  for obj in (\n    select *\n    from user_objects\n    where object_type in ('TABLE', 'VIEW', 'PACKAGE', 'PACKAGE BODY')\n  ) loop\n    dbms_cloud_repo.export_object(\n      repo => l_repo_handle\n      , file_path =>\n          case obj.object_type\n            when 'TABLE'\n              then 'models/' || lower(obj.object_name) || '.sql'\n            when 'VIEW'\n              then 'views/' || lower(obj.object_name) || '.sql'\n            when 'PACKAGE'\n              then 'packages/' || lower(obj.object_name) || '.pks'\n            when 'PACKAGE BODY'\n              then 'packages/' || lower(obj.object_name) || '.pkb'\n          end\n      , object_type =>\n          case obj.object_type\n            when 'TABLE' then 'TABLE'\n            when 'VIEW' then 'VIEW'\n            when 'PACKAGE' then 'PACKAGE_SPEC'\n            when 'PACKAGE BODY' then 'PACKAGE_BODY'\n          end\n      , object_name => obj.object_name\n      , object_schema => user\n      , branch_name => 'main'\n      , commit_details => json_object(\n          'message' value 'DBMS_CLOUD_REPO commit'\n          , 'author' value 'Name Used for Commits'\n          , 'email' value 'my.commit.address@email.com'\n        )\n      , append => false\n    );\n  end loop;\nend;\n/\n")),(0,o.mdx)("admonition",{type:"note"},(0,o.mdx)("p",{parentName:"admonition"},"Alternatively, use the ",(0,o.mdx)("a",{parentName:"p",href:"https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/DBMS_METADATA.html#GUID-A4683EEE-6F54-4081-B7BF-1496096675FA"},(0,o.mdx)("inlineCode",{parentName:"a"},"DBMS_METADATA.GET_DDL"))," procedure for fine-grain control of the data definition language (DDL) code generated, and then commit the code using the ",(0,o.mdx)("inlineCode",{parentName:"p"},"DBMS_CLOUD_REPO.PUT_FILE")," procedure.")),(0,o.mdx)("h2",{id:"task-5---run-sql-code-from-repository"},"Task 5 - Run SQL Code from Repository"),(0,o.mdx)("p",null,"In the final example, the procedure will checkout the file specified in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"DBMS_CLOUD_REPO.INSTALL_FILE")," procedure's ",(0,o.mdx)("inlineCode",{parentName:"p"},"file_path")," parameter and execute in the database."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-sql"},"declare\n  l_repo_handle clob;\nbegin\n  l_repo_handle := dbms_cloud_repo.init_github_repo(\n    credential_name => 'GITHUB_CRED'\n    , owner => 'mygithubaccount'\n    , repo_name => 'myrepo'\n  );\n\n  dbms_cloud_repo.install_file(\n    repo => l_repo_handle\n    , file_path => 'models/mytable.sql',\n    stop_on_error => true\n  );\nend;\n/\n")),(0,o.mdx)("p",null,"If the file ",(0,o.mdx)("inlineCode",{parentName:"p"},"models/mytable.sql")," creates a table named ",(0,o.mdx)("inlineCode",{parentName:"p"},"MYTABLE"),", validate that it was successfully created in the database."),(0,o.mdx)("h2",{id:"references"},"References"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("a",{parentName:"li",href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token"},"GitHub Docs - Creating a personal access token")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("a",{parentName:"li",href:"https://docs.oracle.com/en/cloud/paas/autonomous-database/adbsa/dbms-cloud-repo-package.html"},"Oracle Documentation - DBMS_CLOUD_REPO package.")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("a",{parentName:"li",href:"https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/DBMS_METADATA.html"},"Oracle Documentation - DBMS_METADATA package."))))}p.isMDXComponent=!0},12331:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/allow-content-read-and-write-472898e74eece16f73513d2fd03c1352.png"},23803:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/click-generate-new-token-d07b1d5fbc09b50b27cd3334b4cb3712.png"},7331:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/confirm-permissions-and-create-token-e0175cb6759071d1280132e6c731f250.png"},26913:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/copy-personal-access-token-cd655520cf6e2eb693b05382363e377a.png"},89892:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/navigate-to-developer-settings-df2ee33788c199c8f6f9bda210cf5694.png"},3828:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/navigate-to-settings-5190896ce22d13539be966f917027afa.png"},64359:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/optionally-restrict-repositories-6d8dfd5c0176be1f9b5567c301c90e59.png"},59538:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/provide-name-description-and-expiry-d0db206c9ae8649aa5ac215c897f1f4d.png"},51842:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/select-fine-grained-tokens-e7a4d9ba6fabfd66bab4c60f627ac27c.png"}}]);