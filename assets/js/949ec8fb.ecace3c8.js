"use strict";(self.webpackChunknewsite=self.webpackChunknewsite||[]).push([[46228],{3905:(e,t,n)=>{n.r(t),n.d(t,{MDXContext:()=>p,MDXProvider:()=>m,mdx:()=>f,useMDXComponents:()=>c,withMDXComponents:()=>d});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o.apply(this,arguments)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),d=function(e){return function(t){var n=c(t.components);return a.createElement(e,o({},t,{components:n}))}},c=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},m=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=r,h=d["".concat(i,".").concat(m)]||d[m]||u[m]||o;return n?a.createElement(h,s(s({ref:t},p),{},{components:n})):a.createElement(h,s({ref:t},p))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[h]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},90822:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const o={title:"APEX and XE - A Match for Data Science",tags:["orclapex","ore","data","science","analytics","rstats","research","rdm"],categories:["Technology","Programming","Oracle Application Express"],slug:"id/1724",authors:["fuzziebrain"],date:new Date("2018-11-10T14:01:16.000Z")},i=void 0,s={permalink:"/content/id/1724",source:"@site/posts/apex-and-xe-a-match-for-data-science/index.md",title:"APEX and XE - A Match for Data Science",description:"1280 720 APEX and ORE in Action",date:"2018-11-10T14:01:16.000Z",formattedDate:"November 10, 2018",tags:[{label:"orclapex",permalink:"/content/tags/orclapex"},{label:"ore",permalink:"/content/tags/ore"},{label:"data",permalink:"/content/tags/data"},{label:"science",permalink:"/content/tags/science"},{label:"analytics",permalink:"/content/tags/analytics"},{label:"rstats",permalink:"/content/tags/rstats"},{label:"research",permalink:"/content/tags/research"},{label:"rdm",permalink:"/content/tags/rdm"}],readingTime:5.71,hasTruncateMarker:!0,authors:[{name:"Adrian Png",title:"Senior Cloud Solutions Architect @ Insum",url:"https://github.com/fuzziebrain",imageURL:"https://github.com/fuzziebrain.png",key:"fuzziebrain"}],frontMatter:{title:"APEX and XE - A Match for Data Science",tags:["orclapex","ore","data","science","analytics","rstats","research","rdm"],categories:["Technology","Programming","Oracle Application Express"],slug:"id/1724",authors:["fuzziebrain"],date:"2018-11-10T14:01:16.000Z"},prevItem:{title:"Certs for APEX Social Sign-In",permalink:"/content/id/1725"},nextItem:{title:"For Your Eyes Only - Redact to Protect",permalink:"/content/id/1723"}},l={authorsImageUrls:[void 0]},p=[{value:"A Docker Project for ORE",id:"a-docker-project-for-ore",level:2},{value:"APEX and ORE",id:"apex-and-ore",level:2},{value:"1. Create the Table <code>GAPMINDER</code>",id:"1-create-the-table-gapminder",level:3},{value:"2. Create the scripts <code>PLOTDEMO</code> and <code>GGPLOTDEMO</code>",id:"2-create-the-scripts-plotdemo-and-ggplotdemo",level:3},{value:"3. Grant Rights",id:"3-grant-rights",level:3},{value:"4. Applying the Scripts in APEX",id:"4-applying-the-scripts-in-apex",level:3},{value:"Using R <code>plot</code>",id:"using-r-plot",level:4},{value:"Using <code>ggplot</code>",id:"using-ggplot",level:4},{value:"Besides Docker",id:"besides-docker",level:2},{value:"Conclusion",id:"conclusion",level:2}],d={toc:p};function c(e){let{components:t,...o}=e;return(0,r.mdx)("wrapper",(0,a.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"1280 720 APEX and ORE in Action",src:n(28572).Z,width:"1302",height:"819"})),(0,r.mdx)("p",null,"I ",(0,r.mdx)("a",{parentName:"p",href:"https://insum.ca/oracle-apex-statistics-r-u-serious/"},"wrote"),", quite a while ago, on how ",(0,r.mdx)("a",{parentName:"p",href:"https://apex.oracle.com"},"Oracle Application Express")," (APEX) developers could integrate ",(0,r.mdx)("a",{parentName:"p",href:"https://www.r-project.org"},"R")," functionality/code in their applications. This was done primarily through ",(0,r.mdx)("a",{parentName:"p",href:"https://nodejs.org"},"Node.js")," packages and exposed as RESTful Web Services. Not the ideal solution, but useful for people wanting to integrate R statistical calculations and complex charting, but could not afford the hefty price tag for an Oracle Database Enterprice Edition license, plus the ",(0,r.mdx)("a",{parentName:"p",href:"https://www.oracle.com/technetwork/database/options/advanced-analytics/overview/index.html"},"Oracle Advanced Analytics")," database option."),(0,r.mdx)("p",null,"The revolutionary 18c release of the ",(0,r.mdx)("a",{parentName:"p",href:"https://oracle.com/xe"},"Oracle Database Express Edition")," (XE) significantly changed the Data Analytics playing field. The no-cost platform has resource caps (2 CPU, 2 GB RAM and 12 GB data storage). It's not going to help perform complex ",(0,r.mdx)("a",{parentName:"p",href:"https://wikipedia.org/wiki/Genome-wide_association_study"},"GWAS")," (Genome-wide Association Study), but should suffice for many smaller research projects, statistical reporting and creating useful prediction models."),(0,r.mdx)("p",null,"Unfortunately, the XE website has only a single line that says anything about this cool feature of the database:"),(0,r.mdx)("blockquote",null,(0,r.mdx)("p",{parentName:"blockquote"},"If you prefer R programming, Oracle Database supports that too.")),(0,r.mdx)("p",null,"How do we get started?"),(0,r.mdx)("h2",{id:"a-docker-project-for-ore"},"A Docker Project for ORE"),(0,r.mdx)("p",null,"The ",(0,r.mdx)("a",{parentName:"p",href:"https://docs.oracle.com/cd/E83411_01/"},"Oracle R Enterprise (ORE) Documentation")," provides quite a lot of information on what's involved and how to setup a ORE environment. However, looking at what's installed in XE, it looks like the server components have already been installed (see ",(0,r.mdx)("inlineCode",{parentName:"p"},"$(ORACLE_HOME/R)"),"). And if you attempted a silent ORE server install, the script complains about how a later version has already been installed and would not proceed."),(0,r.mdx)("p",null,"I took it upon myself to waddle through the mud and figure out what's involved to get ORE going on my workstation. The end result was a suite of scripts and ",(0,r.mdx)("a",{parentName:"p",href:"https://docs.docker.com/engine/reference/builder/"},"Dockerfile")," for creating an ORE server and client for running R. These have been published in this public ",(0,r.mdx)("a",{parentName:"p",href:"https://github.com/fuzziebrain/docker-oracle-ore"},"Github repository"),". "),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"NOTE")," that this environment is meant for an explorer to bash quickly through the undergrowth, and head right into some interesting R and APEX coding. The ",(0,r.mdx)("a",{parentName:"p",href:"https://github.com/fuzziebrain/docker-oracle-ore/blob/master/README.md"},"instructions")," and simplicity of running ",(0,r.mdx)("a",{parentName:"p",href:"https://www.docker.com"},"Docker")," containers should provide you a clear path forward."),(0,r.mdx)("h2",{id:"apex-and-ore"},"APEX and ORE"),(0,r.mdx)("p",null,"I'm an APEX developer, so including the environment to create great apps is a must! In this Docker environment, you will find APEX 18.2 and ORDS 18.3 pre-installed, configured and running. The banner image in this post is an actual screenshot of a running APEX app with ORE integration. Both charts are produced by R functions ",(0,r.mdx)("a",{parentName:"p",href:"https://www.rdocumentation.org/packages/graphics/versions/3.3.0/topics/plot"},"plot")," and ",(0,r.mdx)("a",{parentName:"p",href:"https://cran.r-project.org/web/packages/ggplot2/"},"ggplot2")," using ",(0,r.mdx)("a",{parentName:"p",href:"https://www.gapminder.org"},"Gapminder")," ",(0,r.mdx)("a",{parentName:"p",href:"https://github.com/swcarpentry/r-novice-gapminder/blob/gh-pages/data/gapminder-FiveYearData.csv"},"data")," imported into the database."),(0,r.mdx)("h3",{id:"1-create-the-table-gapminder"},"1. Create the Table ",(0,r.mdx)("inlineCode",{parentName:"h3"},"GAPMINDER")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"create table gapminder(\n  row_id number generated by default as identity\n  , country varchar2(100)\n  , year number\n  , pop number \n  , continent varchar2(100)\n  , lifeExp number\n  , gdpPercap number\n)\n/\n\nalter table gapminder\nadd constraint gapminder_pk\nprimary key (row_id)\n;\n")),(0,r.mdx)("h3",{id:"2-create-the-scripts-plotdemo-and-ggplotdemo"},"2. Create the scripts ",(0,r.mdx)("inlineCode",{parentName:"h3"},"PLOTDEMO")," and ",(0,r.mdx)("inlineCode",{parentName:"h3"},"GGPLOTDEMO")),(0,r.mdx)("p",null,"We have an option of using R or SQL APIs to create scripts for embedded execution. The following uses the SQL API ",(0,r.mdx)("inlineCode",{parentName:"p"},"sys.rqScriptCreate"),". In order to create scripts, the database user must have the ",(0,r.mdx)("inlineCode",{parentName:"p"},"RQADMIN")," role. Be wary of who you assigned this to, as R scripts allow access to the database server and there are inherent security risks involved."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-plpgsql"},"begin\n  -- Demo using core R function plot\n  sys.rqScriptCreate(\n    v_name => 'PLOTDEMO'\n    , v_script => q'[\nfunction(data, title) {\n  plot(data, main=title, type=\"o\", col=\"blue\")\n}\n]'\n    , v_global => false\n    , v_overwrite => true\n  );\n\n  -- Demo using a third-party library ggplot2\n  sys.rqScriptCreate(\n    v_name => 'GGPLOTDEMO'\n    , v_script => q'[\nfunction(mdata) {\n  library(ggplot2)\n\n  gplot <- ggplot(\n    mdata\n    , aes(\n        x = GDPPERCAP\n        , y = LIFEEXP\n        , color = CONTINENT\n    )\n  ) + geom_point()\n  plot(gplot)\n}\n]'\n    , v_global => false\n    , v_overwrite => true\n  );\nend;\n/\n")),(0,r.mdx)("h3",{id:"3-grant-rights"},"3. Grant Rights"),(0,r.mdx)("p",null,(0,r.mdx)("a",{parentName:"p",href:"https://twitter.com/brendantierney"},"BrendanTierney")," wrote an excellent ",(0,r.mdx)("a",{parentName:"p",href:"https://www.oralytics.com/2016/08/how-to-get-ore-to-work-with-apex.html"},"blog post")," on the new security model that ORE uses and what is needed to grant the appropriate privileges to allow embedded R scripts to run in APEX. The parsing schema does not require the rights to run these scripts, and in fact, the script will not run in APEX, even if the parsing schema created the script. The grants should be made to the user ",(0,r.mdx)("inlineCode",{parentName:"p"},"APEX_PUBLIC_USER")," instead."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-plpgsql"},"begin \n  rqGrant('PLOTDEMO', 'rqscript', 'APEX_PUBLIC_USER');\n  rqGrant('GGPLOTDEMO', 'rqscript', 'APEX_PUBLIC_USER');\nend;\n/\n")),(0,r.mdx)("p",null,'Alternatively, with security in mind, you may also compile the scripts as "public". Do this by setting the ',(0,r.mdx)("inlineCode",{parentName:"p"},"sys.rqScriptCreate")," argument ",(0,r.mdx)("inlineCode",{parentName:"p"},"v_global")," to ",(0,r.mdx)("inlineCode",{parentName:"p"},"true"),"."),(0,r.mdx)("h3",{id:"4-applying-the-scripts-in-apex"},"4. Applying the Scripts in APEX"),(0,r.mdx)("p",null,"For displaying both charts, a Display Image Page Item was used. With some ",(0,r.mdx)("a",{parentName:"p",href:"https://www.oralytics.com/2016/07/creating-ggplot2-graphics-using-sql.html"},"guidance"),", here's how I have them set up."),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},'Set the "Based On" setting to ',(0,r.mdx)("inlineCode",{parentName:"li"},"BLOB Column returned by SQL statement"),"."),(0,r.mdx)("li",{parentName:"ol"},'For the "SQL Statement", something like these should work.')),(0,r.mdx)("h4",{id:"using-r-plot"},"Using R ",(0,r.mdx)("inlineCode",{parentName:"h4"},"plot")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"with data as (\n  select year as \"Year\", lifeexp as \"Life Expectancy\"\n  from gapminder\n  where 1 = 1\n    and lower(country) = 'singapore'\n  order by year\n)\nselect image\nfrom table(\n  rqTableEval(\n    cursor(select * from data)\n    , cursor(\n        select 'Life Expectancy in Singapore' as \"title\" \n        from dual\n    )\n    , 'PNG'\n    , 'DEMO.PLOTDEMO'\n  )\n)\nwhere id = 1\n")),(0,r.mdx)("h4",{id:"using-ggplot"},"Using ",(0,r.mdx)("inlineCode",{parentName:"h4"},"ggplot")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"with data as (\n  select gdppercap, lifeexp, continent\n  from gapminder\n  where 1 = 1\n)\nselect image\nfrom table(\n  rqTableEval(\n    cursor(select * from data)\n    , null\n    , 'PNG'\n    , 'DEMO.GGPLOTDEMO'\n  )\n)\nwhere id = 1\n")),(0,r.mdx)("p",null,"In both queries, using the ",(0,r.mdx)("inlineCode",{parentName:"p"},"rqTableEval")," funcction, data is retrieved from the database and passed into the scripts' function parameters as a ",(0,r.mdx)("a",{parentName:"p",href:"https://www.rdocumentation.org/packages/base/versions/3.3.0/topics/data.frame"},(0,r.mdx)("inlineCode",{parentName:"a"},"data.frame")),". R developers can then use the data and run various operations, returning the results as a ",(0,r.mdx)("inlineCode",{parentName:"p"},"data.frame"),", (PNG) image or XML."),(0,r.mdx)("p",null,"Also, when referencing scripts, include the schema name that created the script. Without it, only references to public scripts are valid."),(0,r.mdx)("blockquote",null,(0,r.mdx)("p",{parentName:"blockquote"},"Brendan is a well-known presenter and writer on all Data Analytics and Machine Learning with Oracle tools. Be sure to ",(0,r.mdx)("a",{parentName:"p",href:"https://twitter.com/brendantierney"},"follow him"),", ",(0,r.mdx)("a",{parentName:"p",href:"https://www.oralytics.com/"},"read his work")," and maybe buy his books if this is something you wish to pursue further. He's been doing this for quite a while and evidently, I saved a lot of time by looking up his blog in this mini project.")),(0,r.mdx)("h2",{id:"besides-docker"},"Besides Docker"),(0,r.mdx)("p",null,"The Docker environment I have put together isn't production ready. To set this up without Docker and have it running in your environment, take a look at the ",(0,r.mdx)("inlineCode",{parentName:"p"},"Dockerfile")," and relevant shell scripts to figure out what is involved. The following is a summary of activities that need to happen on the server-side."),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"Install a compatible R environment including dependencies for building and install R packages (see ",(0,r.mdx)("a",{parentName:"li",href:"https://github.com/fuzziebrain/docker-oracle-ore/blob/master/server/Dockerfile"},(0,r.mdx)("inlineCode",{parentName:"a"},"Dockerfile")),")."),(0,r.mdx)("li",{parentName:"ul"},"Install R packages listed in ",(0,r.mdx)("a",{parentName:"li",href:"https://github.com/fuzziebrain/docker-oracle-ore/blob/master/server/scripts/enableORE.sh"},(0,r.mdx)("inlineCode",{parentName:"a"},"enableORE.sh")),"."),(0,r.mdx)("li",{parentName:"ul"},"Run the SQL script ",(0,r.mdx)("inlineCode",{parentName:"li"},"$ORACLE_HOME/R/server/rqcfg.sql")," against the target PDB (see ",(0,r.mdx)("a",{parentName:"li",href:"https://github.com/fuzziebrain/docker-oracle-ore/blob/master/server/scripts/enableORE.sh"},(0,r.mdx)("inlineCode",{parentName:"a"},"enableORE.sh")),").")),(0,r.mdx)("h2",{id:"conclusion"},"Conclusion"),(0,r.mdx)("p",null,"APEX is an outstanding tool for ",(0,r.mdx)("strong",{parentName:"p"},"rapidly")," building ",(0,r.mdx)("strong",{parentName:"p"},"modern")," day web applications at ",(0,r.mdx)("strong",{parentName:"p"},"minimal costs and resources"),". Combine this with the ",(0,r.mdx)("strong",{parentName:"p"},"power of R"),", it should be a no-brainer for anyone choosing a development environment for ",(0,r.mdx)("a",{parentName:"p",href:"https://www2.le.ac.uk/services/research-data/rdm/what-is-rdm"},"Research Data Management"),"."))}c.isMDXComponent=!0},28572:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/using-r-with-orclapex-a5b918705a1987bc27527e2c555cce1e.png"}}]);