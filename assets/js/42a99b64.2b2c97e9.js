"use strict";(self.webpackChunknewsite=self.webpackChunknewsite||[]).push([[70264],{3326:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var t=n(85893),i=n(11151);const r={title:"For Your Eyes Only - Redact to Protect",tags:["orclapex","data","redact","confidential","security","protection","compliance"],categories:["Technology","Programming","Oracle Application Express"],slug:"id/1723",authors:["fuzziebrain"],date:new Date("2018-11-03T14:43:57.000Z")},s=void 0,o={permalink:"/content/id/1723",source:"@site/posts/for-your-eyes-only-redact-to-protect/index.md",title:"For Your Eyes Only - Redact to Protect",description:"1280 720 Photo by Kaleidico",date:"2018-11-03T14:43:57.000Z",formattedDate:"November 3, 2018",tags:[{label:"orclapex",permalink:"/content/tags/orclapex"},{label:"data",permalink:"/content/tags/data"},{label:"redact",permalink:"/content/tags/redact"},{label:"confidential",permalink:"/content/tags/confidential"},{label:"security",permalink:"/content/tags/security"},{label:"protection",permalink:"/content/tags/protection"},{label:"compliance",permalink:"/content/tags/compliance"}],readingTime:8.385,hasTruncateMarker:!0,authors:[{name:"Adrian Png",title:"Senior Cloud Solutions Architect @ Insum",url:"https://github.com/fuzziebrain",imageURL:"https://github.com/fuzziebrain.png",key:"fuzziebrain"}],frontMatter:{title:"For Your Eyes Only - Redact to Protect",tags:["orclapex","data","redact","confidential","security","protection","compliance"],categories:["Technology","Programming","Oracle Application Express"],slug:"id/1723",authors:["fuzziebrain"],date:"2018-11-03T14:43:57.000Z"},unlisted:!1,prevItem:{title:"APEX and XE - A Match for Data Science",permalink:"/content/id/1724"},nextItem:{title:"Preview PDF Uploads in an APEX App (Cross-post)",permalink:"/content/id/1722"}},c={authorsImageUrls:[void 0]},l=[{value:"Staging the Example",id:"staging-the-example",level:2},{value:"Create Table <code>PAYMENTINFO</code>",id:"create-table-paymentinfo",level:3},{value:"Add Mock Data",id:"add-mock-data",level:3},{value:"Data Redaction",id:"data-redaction",level:2},{value:"Oracle&#39;s Gift",id:"oracles-gift",level:2},{value:"Applying Data Redaction in APEX",id:"applying-data-redaction-in-apex",level:2},{value:"Selectively Applying Policies",id:"selectively-applying-policies",level:2},{value:"Closing Remarks",id:"closing-remarks",level:2}];function d(e){const a={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components},{Youtube:r}=a;return r||function(e,a){throw new Error("Expected "+(a?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Youtube",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{alt:"1280 720 Photo by Kaleidico",src:n(41175).Z+"",width:"1280",height:"720"})}),"\n",(0,t.jsxs)(a.p,{children:["In a previous ",(0,t.jsx)(a.a,{href:"/content/id/1721",children:"blog post"}),", I provided a recipe for enforcing encryption for data-at-rest. However, it is important to remember that ",(0,t.jsx)(a.a,{href:"https://docs.oracle.com/en/database/oracle/oracle-database/18/asoag/introduction-to-transparent-data-encryption.html#GUID-769EC29B-0107-40FE-9A9D-BF81A4BBD0E9",children:"Transparent Data Encryption"})," (TDE) protects your data from bad actors, who might have illegally gained access to the data files. Data exists unencrypted when loaded and accessed in the database. Malicious attacks can come from internal sources as well. When storing user confidential information, data stewards need to take greater responsibility in ensuring that data is only seen by staff who are authorized and require access to privileged information. That could mean creating tiered access and other protections like data redaction."]}),"\n",(0,t.jsx)(a.p,{children:"For example, an e-commerce website that handles credit card transactions, may require call centre staff to have access to the last four digits of a credit card number for verifying customers' identity when support call are received. Or an insurance claims website that requires claimants to submit their health identity number. The application displays the partially or fully-masked ID, enough to suggest that the data has been captured, but insufficient for a passerby to steal a glance."}),"\n",(0,t.jsxs)(a.p,{children:["Oracle's Data Redaction makes this possible, and with the latest release of ",(0,t.jsx)(a.a,{href:"https://oracle.com/xe",children:"Oracle Database 18c Express Edition"}),", this technology is now ",(0,t.jsx)(a.a,{href:"https://docs.oracle.com/en/database/oracle/oracle-database/18/xelic/licensing-information.html",children:"acessible"})," to developers for ",(0,t.jsx)(a.strong,{children:"FREE"}),"! If you are new to Data Redaction, here's a simple recipe to get started!"]}),"\n",(0,t.jsx)(a.h2,{id:"staging-the-example",children:"Staging the Example"}),"\n",(0,t.jsxs)(a.h3,{id:"create-table-paymentinfo",children:["Create Table ",(0,t.jsx)(a.code,{children:"PAYMENTINFO"})]}),"\n",(0,t.jsxs)(a.p,{children:["Create a simple table called ",(0,t.jsx)(a.code,{children:"paymentinfo"})," to store customers' names and credit card information."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sql",children:"create table paymentinfo (\n  transactionid number generated always as identity\n  , first_name varchar2(200) not null\n  , last_name varchar2(200) not null\n  , ccard_number varchar2(30) not null\n)\n/\n"})}),"\n",(0,t.jsx)(a.h3,{id:"add-mock-data",children:"Add Mock Data"}),"\n",(0,t.jsx)(a.p,{children:"There are many sites and applications out there that help you generate mock data. Here are two examples:"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsx)(a.li,{children:(0,t.jsx)(a.a,{href:"https://www.generatedata.com/",children:"https://www.generatedata.com/"})}),"\n",(0,t.jsx)(a.li,{children:(0,t.jsx)(a.a,{href:"https://www.mockaroo.com/",children:"https://www.mockaroo.com/"})}),"\n"]}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{alt:"Generate Mock Data",src:n(30962).Z+"",width:"1302",height:"819"})}),"\n",(0,t.jsx)(a.p,{children:"Both sites help generate various types of data. For the purpose of demo, I generated a 100 rows of first names, last names and fictitious credit card numbers (any similarities is pure coincidence). Load the data."}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sql",children:"insert into paymentinfo (first_name, last_name, ccard_number) values ('Brigham', 'Raftery', '3558886053942589');\ninsert into paymentinfo (first_name, last_name, ccard_number) values ('Willi', 'Milksop', '3566444037931078');\ninsert into paymentinfo (first_name, last_name, ccard_number) values ('Spencer', 'Toy', '3578657283591918');\ninsert into paymentinfo (first_name, last_name, ccard_number) values ('Eleanor', 'Sherlaw', '201745575867996');\ninsert into paymentinfo (first_name, last_name, ccard_number) values ('Matelda', 'Joskowicz', '3567589132290124');\ninsert into paymentinfo (first_name, last_name, ccard_number) values ('Hyacinth', 'Haville', '201542493937096');\ninsert into paymentinfo (first_name, last_name, ccard_number) values ('Cristi', 'Yakubowicz', '3535186423765655');\ninsert into paymentinfo (first_name, last_name, ccard_number) values ('Bess', 'Atte-Stone', '501891982886122702');\ninsert into paymentinfo (first_name, last_name, ccard_number) values ('Madeleine', 'Spacy', '5299626156704075');\ninsert into paymentinfo (first_name, last_name, ccard_number) values ('Alick', 'Lilly', '4041597161949423');\n"})}),"\n",(0,t.jsx)(a.p,{children:"Now query the data."}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sql",children:"SQL> column first_name format a20\nSQL> column last_name format a20\nSQL> column ccard_number format a20\nSQL> select * from paymentinfo where rownum <= 10;\n\nTRANSACTIONID FIRST_NAME           LAST_NAME            CCARD_NUMBER\n------------- -------------------- -------------------- --------------------\n            1 Brigham              Raftery              3558886053942589\n            2 Willi                Milksop              3566444037931078\n            3 Spencer              Toy                  3578657283591918\n            4 Eleanor              Sherlaw              201745575867996\n            5 Matelda              Joskowicz            3567589132290124\n            6 Hyacinth             Haville              201542493937096\n            7 Cristi               Yakubowicz           3535186423765655\n            8 Bess                 Atte-Stone           501891982886122702\n            9 Madeleine            Spacy                5299626156704075\n           10 Alick                Lilly                4041597161949423\n\n10 rows selected.\n"})}),"\n",(0,t.jsx)(a.h2,{id:"data-redaction",children:"Data Redaction"}),"\n",(0,t.jsxs)(a.p,{children:["When working with ",(0,t.jsx)(a.a,{href:"https://apex.oracle.com",children:"Oracle Application Express"}),' (APEX) or any other programming languages, we would typically use database views to query data for display, e.g. Interactive Reports. We could attempt to "mask" the data with a query something like this:']}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sql",children:"create or replace force view vw_paymentinfo\nas\n  select\n    transactionid\n    , first_name\n    , last_name\n    , case\n        when length(ccard_number) > 4 then\n          regexp_replace(\n            substr(ccard_number, 0, length(ccard_number)-4)\n            , '\\d'\n            , '*'\n          )\n          || substr(ccard_number, -4)\n        else\n          regexp_replace(ccard_number,'\\d','*')\n      end as ccard_number\n  from paymentinfo\n;\n"})}),"\n",(0,t.jsx)(a.p,{children:"Then query the data using the view."}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sql",children:"SQL> select * from vw_paymentinfo where rownum <= 10;\n\nTRANSACTIONID FIRST_NAME           LAST_NAME            CCARD_NUMBER\n------------- -------------------- -------------------- --------------------\n            1 Brigham              Raftery              ************2589\n            2 Willi                Milksop              ************1078\n            3 Spencer              Toy                  ************1918\n            4 Eleanor              Sherlaw              ***********7996\n            5 Matelda              Joskowicz            ************0124\n            6 Hyacinth             Haville              ***********7096\n            7 Cristi               Yakubowicz           ************5655\n            8 Bess                 Atte-Stone           **************2702\n            9 Madeleine            Spacy                ************4075\n           10 Alick                Lilly                ************9423\n\n10 rows selected.\n"})}),"\n",(0,t.jsx)(a.p,{children:'Great! The credit card numbers are successfully masked. However, there are some key concerns with this approach. When implementing security for applications and system, I generally subscribe to a few "golden rules".'}),"\n",(0,t.jsxs)(a.ol,{children:["\n",(0,t.jsx)(a.li,{children:"Avoid reinventing the wheel - the same is said with data encrypting methods. It's always preferred that we apply commonly used, well-tested and accepted algorithms. There are many credit card options. Designing a comprehensive regular expression or string replacement scheme to cover all the available number formats is not easy. Why not rely on off-the-shelf solutions from companies that have invested significantly and has a lot of experience dealing with these issues, for handling these monumental and critical tasks."}),"\n",(0,t.jsx)(a.li,{children:"Separation of duties - if developers have no need to view the data of the applications they build, then perhaps they should not. Creating data security policies and enforcement should preferably be the responsibility of a separate person or team."}),"\n"]}),"\n",(0,t.jsx)(a.h2,{id:"oracles-gift",children:"Oracle's Gift"}),"\n",(0,t.jsx)(a.p,{children:'When Oracle Database 12c was released, the company restructured its Advanced Security Option offering. Secure database connections became a "feature" and a new technology, Data Redaction, was introduced and became part of the for-fee product. We, Oracle Database Developers, are very fortunate that this premium functionality is now available for free with the Oracle Database 18c XE.'}),"\n",(0,t.jsx)(a.p,{children:"With Data Redaction, I am relying on Oracle's vast experiences implementing security and compliance with well-known, well-defined security requirements. It offers predefined redaction rules that not only mask credit card numbers, but national identification numbers, phone numbers, email addresses and even IP addresses."}),"\n",(0,t.jsx)(a.p,{children:'Redaction policies are created at the "database level", so that means they apply regardless of how you access the data. Running a query in SQL Developer, SQLcl or through an APEX application yields the exact same results.'}),"\n",(0,t.jsxs)(a.p,{children:["As a best practice (separation of duties), Oracle encourages customers to use a different user/role for managing redaction policies. Let's begin by creating a user ",(0,t.jsx)(a.code,{children:"sec_admin"})," for this task. We note the following requirements for creating such a user (from the docs):"]}),"\n",(0,t.jsxs)(a.blockquote,{children:["\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsx)(a.li,{children:"To create redaction policies, you must have the EXECUTE privilege on the DBMS_REDACT PL/SQL package."}),"\n",(0,t.jsx)(a.li,{children:"You do not need any privileges to access the underlying tables or views that will be protected by the policy."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(a.p,{children:["Let's do that. As ",(0,t.jsx)(a.code,{children:"SYS"})," user, execute the following commands:"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sql",children:'create user sec_admin identified by "sec_admin";\ngrant create session to sec_admin;\ngrant execute on dbms_redact to sec_admin;\n'})}),"\n",(0,t.jsxs)(a.p,{children:["Note that the user ",(0,t.jsx)(a.code,{children:"sec_admin"}),", would have rights to create and enforce data redaction policies, but will not have access to the data it is tasked to protect."]}),"\n",(0,t.jsxs)(a.p,{children:["Next, ",(0,t.jsx)(a.a,{href:"https://docs.oracle.com/en/database/oracle/oracle-database/18/asoag/configuring-oracle-data-redaction-policies.html#GUID-D32FC6CA-A3B5-47EE-B288-52F1124F9FBD",children:"create a data redaction policy"})," for masking the data in column ",(0,t.jsx)(a.code,{children:"ccard_number"}),"."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sql",children:"begin\n  dbms_redact.add_policy(\n    object_schema => 'secure_user'\n    , object_name => 'paymentinfo'\n    , policy_name => 'ccardnum_mask'\n    , column_name => 'ccard_number'\n    , function_type => dbms_redact.regexp\n    , function_parameters => null\n    , regexp_pattern => dbms_redact.re_pattern_ccn\n    , regexp_replace_string => dbms_redact.re_redact_ccn\n    , regexp_position => dbms_redact.re_beginning\n    , regexp_occurrence => dbms_redact.re_first\n    , regexp_match_parameter => dbms_redact.re_case_insensitive\n    , expression => '1=1'\n  );\nend;\n/\n"})}),"\n",(0,t.jsx)(a.p,{children:"Run the query again."}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sql",children:"SQL> select * from paymentinfo where rownum <= 10;\n\nTRANSACTIONID FIRST_NAME           LAST_NAME            CCARD_NUMBER\n------------- -------------------- -------------------- --------------------\n            1 Brigham              Raftery              ************2589\n            2 Willi                Milksop              ************1078\n            3 Spencer              Toy                  ************1918\n            4 Eleanor              Sherlaw              ************7996\n            5 Matelda              Joskowicz            ************0124\n            6 Hyacinth             Haville              ************7096\n            7 Cristi               Yakubowicz           ************5655\n            8 Bess                 Atte-Stone           ************2702\n            9 Madeleine            Spacy                ************4075\n           10 Alick                Lilly                ************9423\n\n10 rows selected.\n"})}),"\n",(0,t.jsx)(a.h2,{id:"applying-data-redaction-in-apex",children:"Applying Data Redaction in APEX"}),"\n",(0,t.jsxs)(a.p,{children:["Data Redaction policies are enforced regardless of how the data is accessed. In the previous examples, data was queried using SQLcl as the schema owner. Let's try accessing the data using a simple Classic Report that runs the same query against the table ",(0,t.jsx)(a.code,{children:"paymentinfo"}),". Below is a short screen recording of data redaction in action."]}),"\n",(0,t.jsx)(r,{videoId:"2m3aqqhZn8o"}),"\n",(0,t.jsx)("span",{class:"caption",children:"APEX Classic Report with Data Redaction Policy Enforced"}),"\n",(0,t.jsxs)(a.p,{children:["Notice that the data is masked regardless of who accesses the application as the expresion condition is ",(0,t.jsx)(a.code,{children:"1=1"}),"."]}),"\n",(0,t.jsx)(a.h2,{id:"selectively-applying-policies",children:"Selectively Applying Policies"}),"\n",(0,t.jsxs)(a.p,{children:["In this next and final section, we will use ",(0,t.jsx)(a.a,{href:"https://docs.oracle.com/en/database/oracle/oracle-database/18/asoag/configuring-oracle-data-redaction-policies.html#GUID-CF59A02C-1DE8-439B-BC1C-7235915C6D23",children:"Expressions"})," to determine if the data should or should not be masked, depending on the user's role in the application."]}),"\n",(0,t.jsx)(a.p,{children:"We begin by adding an Application Item the should be restricted and may not be set by the browser. Set the application state using a Post-Authentication procedure in the application's current Authentication Scheme."}),"\n",(0,t.jsxs)(a.p,{children:["Next, update the ",(0,t.jsx)(a.code,{children:"expression"})," attribute for the ",(0,t.jsx)(a.code,{children:"ccardnum_mask"})," policy to use the Application Item's session state."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sql",children:"begin\n  dbms_redact.alter_policy(\n    object_schema => 'secure_user'\n    , object_name => 'paymentinfo'\n    , policy_name => 'ccardnum_mask'\n    , column_name => 'ccard_number'\n    , action => dbms_redact.modify_expression\n    , expression => 'v(''APP_ROLE'') != ''Administrator'''\n  );\nend;\n/\n"})}),"\n",(0,t.jsx)(a.p,{children:"Watch the screen recording of how the results of the Classic Report now differs between a User and an Administrator."}),"\n",(0,t.jsx)(r,{videoId:"yeYrZ4092uQ"}),"\n",(0,t.jsx)("span",{class:"caption",children:"Using an Expression for Determining When Data Redaction Policy is Applied"}),"\n",(0,t.jsxs)(a.p,{children:["Even with this approach, a potential loophole remains. A malicious actor (developer) could alter the session state of this item or how it is set, and gain access to the data unprotected. Think about combining data redaction (using ",(0,t.jsx)(a.code,{children:"SYS_XS_CONTEXT"})," in the expression) with Oracle's ",(0,t.jsx)(a.a,{href:"https://www.oracle.com/database/technologies/security/virtual-private-db.html",children:"Real Application Security"})," (RAS) and you'll have a near air-tight solution. RAS incidentally, is also available to use in XE, and if you'd like to learn more, check out Dimitri Gielis' ",(0,t.jsx)(a.a,{href:"http://dgielis.blogspot.com/2015/04/enable-real-application-security-ras-in.html",children:"blog post"})," on enabling RAS in APEX."]}),"\n",(0,t.jsx)(a.h2,{id:"closing-remarks",children:"Closing Remarks"}),"\n",(0,t.jsx)(a.p,{children:"To remove a policy, run the following procedure and specify the object's schema, name and the policy name to drop."}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sql",children:"begin\n  dbms_redact.drop_policy(\n    object_schema => 'secure_user'\n    , object_name => 'paymentinfo'\n    , policy_name => 'ccardnum_mask'\n  );\nend;\n/\n"})}),"\n",(0,t.jsxs)(a.p,{children:["Finally, through this article, I hope I have given you a preview of what the technology is capable of, and have sparked some interest There's much to know and learn about Oracle Data Redaction, the full spectrum of what it offers and its limitations. You are highly encouraged to read the ",(0,t.jsx)(a.a,{href:"https://docs.oracle.com/en/database/oracle/oracle-database/18/asoag/asopart2.html",children:"official documentation"}),", test out various scenarios and consider using this technology, especially if you are a custodian of confidential data."]})]})}function h(e={}){const{wrapper:a}={...(0,i.a)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},41175:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/mistake-968334_1920_1280x720-22734692b1f36768a098fc2882b511fb.jpg"},30962:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/mockaroo-d13f9d31fc9e00bdf5f7d6198e5135d8.png"},11151:(e,a,n)=>{n.d(a,{Z:()=>o,a:()=>s});var t=n(67294);const i={},r=t.createContext(i);function s(e){const a=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function o(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(r.Provider,{value:a},e.children)}}}]);