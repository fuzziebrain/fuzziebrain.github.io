"use strict";(self.webpackChunknewsite=self.webpackChunknewsite||[]).push([[46967],{3905:(e,t,a)=>{a.r(t),a.d(t,{MDXContext:()=>c,MDXProvider:()=>m,mdx:()=>g,useMDXComponents:()=>p,withMDXComponents:()=>d});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o.apply(this,arguments)}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),d=function(e){return function(t){var a=p(t.components);return n.createElement(e,o({},t,{components:a}))}},p=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(c.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},y=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(a),m=r,u=d["".concat(l,".").concat(m)]||d[m]||h[m]||o;return a?n.createElement(u,s(s({ref:t},c),{},{components:a})):n.createElement(u,s({ref:t},c))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,l=new Array(o);l[0]=y;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[u]="string"==typeof e?e:r,l[1]=s;for(var c=2;c<o;c++)l[c]=a[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}y.displayName="MDXCreateElement"},13204:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var n=a(87462),r=(a(67294),a(3905));const o={title:"Protect Your Data with Transparent Data Encryption",tags:["oracle database","18cXE","orclapex","tde","tls","security","pki"],categories:["Technology","Programming","Oracle Application Express"],slug:"id/1721",authors:["fuzziebrain"],date:new Date("2018-10-27T01:31:06.000Z")},l=void 0,s={permalink:"/content/id/1721",source:"@site/posts/protect-your-data-with-transparent-data-encryption/index.md",title:"Protect Your Data with Transparent Data Encryption",description:"1280 720 Photo by TheDigitalArtist",date:"2018-10-27T01:31:06.000Z",formattedDate:"October 27, 2018",tags:[{label:"oracle database",permalink:"/content/tags/oracle-database"},{label:"18cXE",permalink:"/content/tags/18-c-xe"},{label:"orclapex",permalink:"/content/tags/orclapex"},{label:"tde",permalink:"/content/tags/tde"},{label:"tls",permalink:"/content/tags/tls"},{label:"security",permalink:"/content/tags/security"},{label:"pki",permalink:"/content/tags/pki"}],readingTime:5.115,hasTruncateMarker:!0,authors:[{name:"Adrian Png",title:"Senior Cloud Solutions Architect @ Insum",url:"https://github.com/fuzziebrain",imageURL:"https://github.com/fuzziebrain.png",key:"fuzziebrain"}],frontMatter:{title:"Protect Your Data with Transparent Data Encryption",tags:["oracle database","18cXE","orclapex","tde","tls","security","pki"],categories:["Technology","Programming","Oracle Application Express"],slug:"id/1721",authors:["fuzziebrain"],date:"2018-10-27T01:31:06.000Z"},prevItem:{title:"Preview PDF Uploads in an APEX App (Cross-post)",permalink:"/content/id/1722"},nextItem:{title:"We Have a Wallet",permalink:"/content/id/1720"}},i={authorsImageUrls:[void 0]},c=[],d={toc:c};function p(e){let{components:t,...o}=e;return(0,r.mdx)("wrapper",(0,n.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"1280 720 Photo by TheDigitalArtist",src:a(76891).Z,width:"1280",height:"720"})),(0,r.mdx)("p",null,(0,r.mdx)("a",{parentName:"p",href:"https://docs.oracle.com/en/database/oracle/oracle-database/18/asoag/introduction-to-transparent-data-encryption.html#GUID-769EC29B-0107-40FE-9A9D-BF81A4BBD0E9"},"Transparent Data Encryption")," (TDE) is a powerful database feature that allows developers and administrators to very quickly, persist data encrypted at-rest. Applications do not require explicit coding to encrypt data for storage. TDE manages encryption during storage, and decryption when data is read, transparently and automatically."),(0,r.mdx)("p",null,'TDE can also be used during backups. In the typical "',(0,r.mdx)("em",{parentName:"p"},"tape falls off the back of the truck"),'" scenario, malicious actors would not be able to decipher the data on the lost tapes without the crucial encryption key stored in the Oracle Wallet. Assuming of course, the wallet was not backed up to the same tape.'),(0,r.mdx)("p",null,"This enterprise-grade feature is found in the ",(0,r.mdx)("a",{parentName:"p",href:"https://www.oracle.com/database/technologies/security/advanced-security.html"},"Oracle Advanced Security")," Database Option. That requires user to be licensed for database enterprise edition. However, with ",(0,r.mdx)("a",{parentName:"p",href:"https://oracle.com/xe"},"Oracle Database 18c Express Edition")," (18cXE), Oracle has made it free and accessible by everyone!"),(0,r.mdx)("p",null,"This post was specially written for ",(0,r.mdx)("a",{parentName:"p",href:"https://apex.oracle.com"},"Oracle Application Express")," (APEX) developers who are new to this technology. It provides a simple workflow for creating an encrypted tablespaces. Since APEX application live on the database, placing the parsing schema on a TDE-enabled tablespace, automatically protects the entire application. Hopefully this will encourage you to use it for protecting ",(0,r.mdx)("a",{parentName:"p",href:"https://wikipedia.org/wiki/Personally_identifiable_information"},"Personally Identifiable Information")," (PII) or any other sensitive and confidential data."),(0,r.mdx)("p",null,"If you are trying out 18cXE using the ",(0,r.mdx)("a",{parentName:"p",href:"https://github.com/fuzziebrain/docker-oracle-xe"},"Docker image")," ",(0,r.mdx)("a",{parentName:"p",href:"https://twitter.com/martindsouza"},"Martin D'Souza")," and I worked on, access the database container using the following command:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"$ docker exec -it -u oracle oracledb bash\n")),(0,r.mdx)("p",null,"Typically, the wallets would be located (",(0,r.mdx)("inlineCode",{parentName:"p"},"WALLET_ROOT"),") in ",(0,r.mdx)("inlineCode",{parentName:"p"},"$ORACLE_BASE/admin/$ORACLE_SID/wallet"),". However, when running the DB as a Docker container, developers are encouraged to map ",(0,r.mdx)("inlineCode",{parentName:"p"},"/opt/oracle/oradata")," to a directory on the host machine. That way, the container can be destroyed without losing your data files, configuration files and now Oracle Wallet(s)."),(0,r.mdx)("p",null,"As the ",(0,r.mdx)("inlineCode",{parentName:"p"},"oracle")," user, create the directory ",(0,r.mdx)("inlineCode",{parentName:"p"},"/opt/oracle/oradata/wallets")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"mkdir -p /opt/oracle/oradata/wallets\n")),(0,r.mdx)("p",null,"Login to the database as ",(0,r.mdx)("inlineCode",{parentName:"p"},"SYSDBA"),":"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"$ . oraenv\nORACLE_SID = [oracle] ? XE\nThe Oracle base has been set to /opt/oracle\n$ sqlplus / as sysdba\n")),(0,r.mdx)("p",null,"Check that ",(0,r.mdx)("inlineCode",{parentName:"p"},"WALLET_ROOT")," hasn't already been set:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"SQL> show parameter wallet_root\n\nNAME                     TYPE    VALUE\n------------------------------------ ----------- ------------------------------\nwallet_root              string\n")),(0,r.mdx)("p",null,"Set the ",(0,r.mdx)("inlineCode",{parentName:"p"},"wallet_root")," location, then restart the database:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"SQL> alter system set wallet_root='/opt/oracle/oradata/wallets' scope=spfile;\n\nSystem altered.\n\nSQL> shutdown immediate;\nDatabase closed.\nDatabase dismounted.\nORACLE instance shut down.\nSQL> startup\nORACLE instance started.\n\nTotal System Global Area 1610609928 bytes\nFixed Size          8897800 bytes\nVariable Size         805306368 bytes\nDatabase Buffers      788529152 bytes\nRedo Buffers            7876608 bytes\nDatabase mounted.\nDatabase opened.\n")),(0,r.mdx)("p",null,"Check that the ",(0,r.mdx)("inlineCode",{parentName:"p"},"TDE_CONFIGURATION")," hasn't already been set:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"SQL> show parameter tde_configuration;\n\nNAME                     TYPE    VALUE\n------------------------------------ ----------- ------------------------------\ntde_configuration            string\n")),(0,r.mdx)("p",null,"Set the ",(0,r.mdx)("inlineCode",{parentName:"p"},"TDE_CONFIGURATION"),":"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},'SQL> alter system set tde_configuration="keystore_configuration=file" scope=both;\n\nSystem altered.\n')),(0,r.mdx)("p",null,"Create a wallet in ",(0,r.mdx)("inlineCode",{parentName:"p"},"/opt/oracle/oradata/wallets/tde"),":"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},'SQL> administer key management create keystore identified by "superSecret111";\n\nkeystore altered.\n')),(0,r.mdx)("p",null,"Open the keystore for ",(0,r.mdx)("inlineCode",{parentName:"p"},"CDB$ROOT")," and ",(0,r.mdx)("inlineCode",{parentName:"p"},"XEPDB1")," containers:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},'SQL> administer key management set keystore open identified by "superSecret111" container = all;\n\nkeystore altered.\n')),(0,r.mdx)("p",null,"Set the master key for ",(0,r.mdx)("inlineCode",{parentName:"p"},"CDB$ROOT")," and ",(0,r.mdx)("inlineCode",{parentName:"p"},"XEPDB1")," containers:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},'SQL> administer key management set key identified by "superSecret111" with backup container = all;\n\nkeystore altered.\n')),(0,r.mdx)("p",null,"Check that the keystores (except the seed container) are all open and master keys set:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"SQL> column name format a30\nSQL> select c.name, w.status\n  2  from v$encryption_wallet w, v$containers c\n  3  where c.con_id = w.con_id;\n\nNAME                   STATUS\n------------------------------ ------------------------------\nCDB$ROOT               OPEN\nPDB$SEED               CLOSED\nXEPDB1                 OPEN\n")),(0,r.mdx)("p",null,"In the PDB, create a tablespace, a user with the encrypted tablespace as default and grant the necessary roles. Supported encryption algorithms are listed ",(0,r.mdx)("a",{parentName:"p",href:"https://docs.oracle.com/en/database/oracle/oracle-database/18/asoag/introduction-to-transparent-data-encryption.html#GUID-AAE3C965-C6A8-45D6-BA5D-F88B300A301A"},"here"),". Below is a sample script for creating an encrypted tablespace:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"create tablespace secure_ts\n  datafile '/opt/oracle/oradata/XE/XEPDB1/secure_ts01.dbf'\n  size 10M autoextend on next 5M\n  encryption using 'AES256' encrypt\n;\n\ncreate user secure_user identified by secure_user\n  default tablespace secure_ts\n  quota unlimited on secure_ts\n;\n\ngrant connect to secure_user;\ngrant resource to secure_user;\n")),(0,r.mdx)("p",null,"Login to the PDB as the user ",(0,r.mdx)("inlineCode",{parentName:"p"},"secure_user")," and create simple database objects and insert some records, for example:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"create table sample(id number);\n\ninsert into sample values (1);\n\ncommit;\n\nselect * from sample;\n")),(0,r.mdx)("p",null,"Restart the database, reconnect as ",(0,r.mdx)("inlineCode",{parentName:"p"},"secure_user")," and query the table again."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"SQL> alter session set container = xepdb1;\n\nSession altered.\n\nSQL> select * from secure_user.sample;\nselect * from secure_user.sample\n                          *\nERROR at line 1:\nORA-28365: wallet is not open\n")),(0,r.mdx)("p",null,"A quick check on the wallet status should explain why:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"SQL> alter session set container = cdb$root;\n\nSession altered.\n\nSQL> select c.name, w.status\n  2  from v$encryption_wallet w, v$containers c\n  3  where c.con_id = w.con_id;\n\nNAME                   STATUS\n------------------------------ ------------------------------\nCDB$ROOT               CLOSED\nPDB$SEED               CLOSED\nXEPDB1                 CLOSED\n")),(0,r.mdx)("p",null,"The wallet is no longer open after the database restarted. We will need to make this happen automatically. We do that by converting the keystore into an ",(0,r.mdx)("inlineCode",{parentName:"p"},"auto_login")," keystore:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"SQL> administer key management create auto_login keystore from keystore '/opt/oracle/oradata/wallets/tde' identified by \"superSecret111\";\n\nkeystore altered;\n")),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"IMPORTANT NOTES")),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"There are many ",(0,r.mdx)("a",{parentName:"li",href:"https://docs.oracle.com/en/database/oracle/oracle-database/18/asoag/general-considerations-of-using-transparent-data-encryption.html#GUID-ED481093-51B0-42F2-BADB-E5E55889AD47"},"security considerations")," that require thought before roling out TDE.",(0,r.mdx)("ul",{parentName:"li"},(0,r.mdx)("li",{parentName:"ul"},"One of them is about keeping the keys safe.In this post, the keystore was made to ",(0,r.mdx)("inlineCode",{parentName:"li"},"auto_login"),", which really isn't as safe as insisting, with the ",(0,r.mdx)("inlineCode",{parentName:"li"},"local")," keyword, that the wallet only opens on one host. I did not use this in the example as it is intended to work with Docker. Making the wallet set to allow automatic wallet opening could cause data loss if the container is dropped then restored."),(0,r.mdx)("li",{parentName:"ul"},"Hardware-based key management systems are preferred and safer. They should be considered if budget and resource permits."))),(0,r.mdx)("li",{parentName:"ul"},"The keystore and TDE master encryption keys are managed in United Mode. I had intended to use the Isolated Mode, but apparently, that might not be supported in XE.")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sql"},"SQL> alter system set tde_configuration=\"keystore_configuration=file\" scope=both;\nalter system set tde_configuration=\"keystore_configuration=file\" scope=both\n*\nERROR at line 1:\nORA-32017: failure in updating SPFILE\nORA-12754: Feature 'Per-PDB TDE keystore' is disabled due to missing capability\n'Runtime Environment'.\n")),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"Last but not least, keep your wallets saved/safe in a separate secure location. ",(0,r.mdx)("strong",{parentName:"li"},"DO NOT")," loose them. Failing to protect them will cause irreversible, catastrophic loss of data.")),(0,r.mdx)("p",null,"Enjoy Oracle Advanced Security!"))}p.isMDXComponent=!0},76891:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/hacker-2002907_1920_1280x720-2c373ffd2546d1007d6cbacf55db0eaa.jpg"}}]);