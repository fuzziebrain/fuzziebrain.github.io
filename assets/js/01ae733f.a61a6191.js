"use strict";(self.webpackChunknewsite=self.webpackChunknewsite||[]).push([[14470],{60757:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var n=a(85893),r=a(11151);const s={title:"Search Better with Oracle Text",tags:["orclapex","Oracle Text","search","rdm"],categories:["Technology","Programming","Oracle Application Express"],slug:"id/1715",authors:["fuzziebrain"],date:new Date("2018-09-25T01:00:29.000Z")},i=void 0,o={permalink:"/content/id/1715",source:"@site/posts/search-better-with-oracle-text/index.md",title:"Search Better with Oracle Text",description:"Photo by John Michael Thompson",date:"2018-09-25T01:00:29.000Z",formattedDate:"September 25, 2018",tags:[{label:"orclapex",permalink:"/content/tags/orclapex"},{label:"Oracle Text",permalink:"/content/tags/oracle-text"},{label:"search",permalink:"/content/tags/search"},{label:"rdm",permalink:"/content/tags/rdm"}],readingTime:8.685,hasTruncateMarker:!1,authors:[{name:"Adrian Png",title:"Senior Cloud Solutions Architect @ Insum",url:"https://github.com/fuzziebrain",imageURL:"https://github.com/fuzziebrain.png",key:"fuzziebrain"}],frontMatter:{title:"Search Better with Oracle Text",tags:["orclapex","Oracle Text","search","rdm"],categories:["Technology","Programming","Oracle Application Express"],slug:"id/1715",authors:["fuzziebrain"],date:"2018-09-25T01:00:29.000Z"},unlisted:!1,prevItem:{title:"Upcoming Chrome APIs of Note",permalink:"/content/id/1716"},nextItem:{title:"Research-Ready",permalink:"/content/id/1714"}},l={authorsImageUrls:[void 0]},c=[{value:"Setting the Stage",id:"setting-the-stage",level:2},{value:"Quick SQL Shorthand",id:"quick-sql-shorthand",level:4},{value:"Oracle SQL Output",id:"oracle-sql-output",level:4},{value:"Filling Up the Repository",id:"filling-up-the-repository",level:2},{value:"Search-Enabling the Table of Grants Awarded",id:"search-enabling-the-table-of-grants-awarded",level:2},{value:"Required Database Privileges",id:"required-database-privileges",level:3},{value:"Create the Oracle Text Index.",id:"create-the-oracle-text-index",level:3},{value:"Query the Data",id:"query-the-data",level:3},{value:"Querying with APEX",id:"querying-with-apex",level:2},{value:"Multilingual Search",id:"multilingual-search",level:2},{value:"Final Notes",id:"final-notes",level:2},{value:"Software Used",id:"software-used",level:4}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Photo by John Michael Thompson",src:a(33952).Z+"",width:"1280",height:"720"})}),"\n",(0,n.jsxs)(t.p,{children:["It's not unusual for an established ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Principal_investigator",children:"principal investigator"})," (PI) to have desks and shelves full of books, journal articles, grant applications, graduate student theses etc. Often, they'd also have a mountain of such material in electronic form and stored on desktop hard drives that sometimes get forgotten. It takes an extremely good memory to remember which articles are relevant to a particular keyword you might be interested in."]}),"\n",(0,n.jsxs)(t.p,{children:["Thankfully, there's Oracle Text (and ",(0,n.jsx)(t.a,{href:"https://apex.oracle.com/",children:"Oracle Application Express"})," (APEX)) to keep you sane!"]}),"\n",(0,n.jsx)(t.h2,{id:"setting-the-stage",children:"Setting the Stage"}),"\n",(0,n.jsxs)(t.p,{children:["I'm not a researcher myself, so naturally, I don't horde a lot of these materials. For the purpose of this blog post, I will use ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Open_data",children:"open data"})," made available, courtesy of the Canadian Government."]}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.a,{href:"http://www.nserc-crsng.gc.ca",children:"National Sciences and Engineering Council of Canada"})," (NSERC) is one of Canada's federal agencies that is responsible for promoting and providing funding for research in the natural sciences and engineering fields. They publish annual lists of grants that were successfully awarded. You can find them ",(0,n.jsx)(t.a,{href:"https://open.canada.ca/data/en/dataset/c1b0f627-8c29-427c-ab73-33968ad9176e",children:"here"}),". I used only one year's (2017) worth of data. There's a lot of research activity going on in the north!"]}),"\n",(0,n.jsxs)(t.p,{children:["Start off by first creating the necessary data structure to hold the data. I used the ",(0,n.jsx)(t.a,{href:"https://apex.oracle.com/quicksql/",children:"Quick SQL"})," tool to quickly generate the necessary ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Data_definition_language",children:"DDL"})," script and then create the database."]}),"\n",(0,n.jsx)(t.h4,{id:"quick-sql-shorthand",children:"Quick SQL Shorthand"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"# settings = { genPK: false, db: 11g }\naward\n    id number /pk\n    name varchar2(200)\n    department varchar2(200)\n    organization_id number\n    institution varchar2(200)\n    province varchar2(100)\n    country varchar2(100)\n    fiscal_year number\n    competition_year number\n    award_amount number\n    program_id varchar2(50)\n    program_name varchar2(200)\n    program_group varchar2(100)\n    committee_code number\n    committee_name varchar2(200)\n    area_of_application_code number\n    area_of_application_group varchar2(200)\n    area_of_application varchar2(200)\n    research_subject_code number\n    research_subject_group varchar2(200)\n    research_subject varchar2(200)\n    application_title varchar2(500)\n    source varchar2(50)\n    application_summary varchar2(4000)\n"})}),"\n",(0,n.jsx)(t.h4,{id:"oracle-sql-output",children:"Oracle SQL Output"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"create table award (\n    id                             number not null constraint award_id_pk primary key,\n    name                           varchar2(200),\n    department                     varchar2(200),\n    organization_id                number,\n    institution                    varchar2(200),\n    province                       varchar2(100),\n    country                        varchar2(100),\n    fiscal_year                    number,\n    competition_year               number,\n    award_amount                   number,\n    program_id                     varchar2(50),\n    program_name                   varchar2(200),\n    program_group                  varchar2(100),\n    committee_code                 number,\n    committee_name                 varchar2(200),\n    area_of_application_code       number,\n    area_of_application_group      varchar2(200),\n    area_of_application            varchar2(200),\n    research_subject_code          number,\n    research_subject_group         varchar2(200),\n    research_subject               varchar2(200),\n    application_title              varchar2(500),\n    source                         varchar2(50),\n    application_summary            varchar2(4000)\n)\n;\n"})}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"NOTE"}),"\nChange the DB version as required. The default is 12c, but since I am running the database Express Edition (XE), I used 11g."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"filling-up-the-repository",children:"Filling Up the Repository"}),"\n",(0,n.jsxs)(t.p,{children:["The data from NSERC is fairly clean and formatted. The 2017 data that I downloaded however, was a little too large to import using the built-in SQL Workshop tool in APEX. Fortunately, ",(0,n.jsx)(t.a,{href:"https://www.oracle.com/database/technologies/appdev/sql-developer.html",children:"SQL Developer"})," has a rather sophisticated functionality for doing the same, though it wasn't without challenges. I'll leave data importing methods for another day's discussion. For the purpose of this exercise, I did managed to import at least 5,000 records."]}),"\n",(0,n.jsx)(t.h2,{id:"search-enabling-the-table-of-grants-awarded",children:"Search-Enabling the Table of Grants Awarded"}),"\n",(0,n.jsx)(t.p,{children:"Oracle Text is a very powerful, no-cost feature of the Oracle Database that doesn't get enough attention as it should. There are many interesting concepts and customizations that can be applied and tune the Oracle Text Index. However, creating a basic index is rather straightforward and should not be feared."}),"\n",(0,n.jsx)(t.p,{children:"My goal:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"List grant awards that are about fossil fuels and the effects on the environment."}),"\n",(0,n.jsx)(t.li,{children:"The corpus contains applications written in both English and French. Users should be able to search with either language."}),"\n",(0,n.jsxs)(t.li,{children:["Users enter search terms using only ",(0,n.jsx)("u",{children:"one"})," text field, but search ",(0,n.jsx)(t.strong,{children:"must"})," include the following columns:","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"application_title"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"application_summary"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"research_subject"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"area_of_application"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"required-database-privileges",children:"Required Database Privileges"}),"\n",(0,n.jsxs)(t.p,{children:["To work with Oracle Text, the database user requires a few additional privileges that have already been granted to the role ",(0,n.jsx)(t.code,{children:"CTXAPP"}),". Assigning the user to the role should be all that's needed:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"grant ctxapp to dbuser;\n"})}),"\n",(0,n.jsx)(t.h3,{id:"create-the-oracle-text-index",children:"Create the Oracle Text Index."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"begin\n    -- Remove any previously created DATASTORE preference with the same name.\n    begin\n       ctx_ddl.drop_preference('SEARCH_DATASTORE');\n    exception\n        when others then null;\n    end;\n\n    -- Create the DATASTORE preference.\n    ctx_ddl.create_preference('SEARCH_DATASTORE', 'MULTI_COLUMN_DATASTORE');\n    ctx_ddl.set_attribute('SEARCH_DATASTORE', 'COLUMNS', 'application_title, application_summary, research_subject, area_of_application');\n\n    -- Drop any existing index with the same name.\n    begin\n        execute immediate 'drop index award_idx';\n    exception\n        when others then null;\n    end;\n\n    -- Create the index.\n    execute immediate q'[\ncreate index award_idx on award(application_title)\nindextype is ctxsys.context\nparameters (q'{\n    DATASTORE SEARCH_DATASTORE\n}')\n]';\nend;\n/\n"})}),"\n",(0,n.jsx)(t.p,{children:"The comments in the procedure shown above explains the basic commands needed to create the index. For convenience, they are listed below:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"Remove any previously created preference with the same name."}),"\n",(0,n.jsxs)(t.li,{children:["Create the ",(0,n.jsx)(t.a,{href:"https://docs.oracle.com/cd/E11882_01/text.112/e24436/cdatadic.htm#CCREF0203",children:"DATASTORE"})," preference."]}),"\n",(0,n.jsx)(t.li,{children:"Drop any existing index with the same name."}),"\n",(0,n.jsx)(t.li,{children:"Create the index."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"As mentioned, there are additional indexing elements that could be used to further optimise and customize the search index, but they are out of scope at this time. This simple setup will already allow some powerful search abilities with minimal query design."}),"\n",(0,n.jsx)(t.h3,{id:"query-the-data",children:"Query the Data"}),"\n",(0,n.jsxs)(t.p,{children:["There are different operators to use in the ",(0,n.jsx)(t.code,{children:"WHERE"})," clause, depending on the index type created. In the example, an index of type ",(0,n.jsx)(t.code,{children:"CONTEXT"})," was created, thus the query will have to be constructed using the ",(0,n.jsx)(t.code,{children:"CONTAINS"})," operator."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"select\n    id\n    , application_title\n    , application_summary\nfrom award\nwhere 1 = 1\n    and contains(application_title, '\"fossil fuels\" and environment', 1) > 0\norder by search_score desc;\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Oracle provides a long list of ",(0,n.jsx)(t.code,{children:"CONTAINS"})," ",(0,n.jsx)(t.a,{href:"https://docs.oracle.com/cd/E11882_01/text.112/e24436/cqoper.htm#CCREF0300",children:"query operators"})," that allows users to formulate powerful queries. The example above is a simple boolean search (",(0,n.jsx)(t.code,{children:"AND"}),' operator) requiring both the phrase "fossil fuels" and word "environment" for a match. A simple misspelling of "environment" would likely yield no results. That\'s where other operators like ',(0,n.jsx)(t.code,{children:"fuzzy"}),' provide a margin error, allowing returning results even when there are no exact matches. The same operator might even forgive simple nuances like "colour" versus "color". There are also wildcard (',(0,n.jsx)(t.code,{children:"%"}),") and other operators that are denoted using special characters that could sometimes spell trouble even for a seasoned Oracle Text user."]}),"\n",(0,n.jsxs)(t.p,{children:["To protect the untrained user, it is recommended to pre-process the user input and restructure keywords and options into proper query operator constructs. This isn't always easy, and so, we are fortunate that ",(0,n.jsx)(t.a,{href:"https://blogs.oracle.com/author/roger-ford",children:"Roger Ford"}),", Oracle Text's Product Manager, posted a ",(0,n.jsx)(t.a,{href:"https://blogs.oracle.com/searchtech/oracle-text-query-parser",children:"blog"})," and useful utility package for parsing user inputs from a simple text field. The syntax closely resembles Google's search operators and should be familiar with most users. The code is available to download at the end of Ford's article."]}),"\n",(0,n.jsxs)(t.p,{children:["After compiling the script, functions such as ",(0,n.jsx)(t.code,{children:"parser.simpleSearch"})," and ",(0,n.jsx)(t.code,{children:"parser.andSearch"})," will be available to use. Check the comments in the code for details about each function."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"SQL> select parser.andsearch('\"fossil fuels\" environment') from dual;\n-- returns ({fossil fuels}&{environment})\n"})}),"\n",(0,n.jsx)(t.h2,{id:"querying-with-apex",children:"Querying with APEX"}),"\n",(0,n.jsxs)(t.p,{children:["With too little screen space on a blog post, it's easier to demonstrate the search results using APEX. The accompanying ",(0,n.jsx)(t.a,{href:"https://apeks.app/ords/f?p=awardsearch",children:"demo application"})," showcases Oracle Text integration using two different user interface approaches."]}),"\n",(0,n.jsxs)(t.p,{children:["The first uses Interactive Grids (IG) that has built-in support for Oracle Text. After creating the IG, click on ",(0,n.jsx)(t.code,{children:"Attributes"})," and then on the right, scroll down to the ",(0,n.jsx)(t.code,{children:"Advanced"})," section and select the indexed column as the ",(0,n.jsx)(t.code,{children:"Oracle Text Index Column"})," attribute."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Setup Oracle Text for Interactive Grids",src:a(83527).Z+"",width:"1470",height:"766"})}),"\n",(0,n.jsxs)(t.p,{children:["Interactive Grids allows developers to specify a PL/SQL function for converting simple keyword inputs to well-formed Oracle Text syntax. Go to the application's ",(0,n.jsx)(t.code,{children:"Shared Components"}),"> ",(0,n.jsx)(t.code,{children:"Component Settings"})," > ",(0,n.jsx)(t.code,{children:"Interactive Grids"})," and then enter the name of the function to use. We can use one of the functions from Ford's Parser package as they meet the requirement of accepting a single string argument."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Specify a PL/SQL Function for Preprocessing Input String",src:a(25995).Z+"",width:"1462",height:"821"})}),"\n",(0,n.jsxs)(t.p,{children:["The second approach uses a Classic Report (CR) that allows more flexibility on how the results are displayed, for example, sorting the results by score (descending) and application title (ascending). The user enters the search keywords in a single text field page item (",(0,n.jsx)(t.code,{children:"P2_SEARCH_TERMS"}),") that is then parsed and used with a ",(0,n.jsx)(t.code,{children:"CONTAINS"})," operator to query the table. The SQL query used is as follows:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"select\n    application_title as search_title\n    , application_summary as search_desc\n    , round(score(1), 2) as value_01\n    , 'Score' as label_01\n    , q'[javascript:apex.message.alert('Not implemented.');void(0);]' as search_link\nfrom award\nwhere 1 = 1\n    and contains(application_title, parser.progrelax(:P2_SEARCH_TERMS), 1) > 0\n"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Displaying Oracle Text Search Results Using Classic Reports",src:a(4344).Z+"",width:"1462",height:"801"})}),"\n",(0,n.jsx)(t.h2,{id:"multilingual-search",children:"Multilingual Search"}),"\n",(0,n.jsxs)(t.p,{children:['Both search interfaces will accept either English or French keywords. However, search results are language-specific. If an English keyword is entered, then only applications submitted in English will be returned. Likewise with French search terms. For a heterogenous search, a thesaurus will be required. The parsing function will also need to be "translation-aware", and either accept or transform queries to use operators such as ',(0,n.jsx)(t.code,{children:"TR"}),". These translation operators will expand the search keywords to include the specified language's equivalent term."]}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"ctxload"})," utility provides developers the ability to import a thesaurus contained in a plain-text file. Developers can also script the thesaurus:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"declare\n    l_thes_name varchar2(11) := 'SCIENG_THES';\nbegin\n    ctx_thes.create_thesaurus(name => l_thes_name);\n    ctx_thes.create_phrase(tname => l_thes_name, phrase => 'water');\n    ctx_thes.create_phrase(tname => l_thes_name, phrase => 'waters');\n    ctx_thes.create_translation(tname => l_thes_name, phrase => 'water', language => 'FRENCH', translation => 'eau');\n    ctx_thes.create_translation(tname => l_thes_name, phrase => 'waters', language => 'FRENCH', translation => 'eaux');\nend;\n/\n"})}),"\n",(0,n.jsx)(t.p,{children:'Unfortunately, Ford\'s parser library does not support translations, but here\'s an example query that could be used to demonstrate the translation capability. The search term is "water", and the results will return both English and French applications containing either "water" or "eau":'}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"select\n    id\n    , score(1) as search_score\n    , application_title\n    , application_summary\nfrom award\nwhere 1 = 1\n    and contains(application_title, 'tr(water, french, scieng_thes)', 1) > 0\norder by search_score desc;\n"})}),"\n",(0,n.jsx)(t.h2,{id:"final-notes",children:"Final Notes"}),"\n",(0,n.jsxs)(t.p,{children:["Besides searching large bodies of text, Oracle Text has the ability to index and search binary files such as PDF, HTML, XML and even Microsoft Word documents. Check out a full list of ",(0,n.jsx)(t.a,{href:"https://docs.oracle.com/cd/E11882_01/text.112/e24436/afilsupt.htm#CCREF1300",children:"supported document formats"}),"."]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"NOTE:"}),"\nIf the document filtering appears not to be working , i.e. a query does not return any expected results, then check that the needed operating system libraries, e.g. ",(0,n.jsx)(t.code,{children:"compat-libstdc++-33"}),", have been installed. You can test this by running the binary: ",(0,n.jsx)(t.code,{children:"$ORACLE_HOME/ctx/bin/ctxhx"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["Get more background about this ",(0,n.jsx)(t.a,{href:"https://community.oracle.com/thread/4028703",children:"thread"})," on the Oracle community forums."]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"All the technology described and used in this blog post and demo are available to at no cost. That's always a welcomed surprise for any research project."}),"\n",(0,n.jsx)(t.h4,{id:"software-used",children:"Software Used"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Software"}),(0,n.jsx)(t.th,{children:"Cost"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Oracle Database 11gR2 XE"}),(0,n.jsx)(t.td,{children:"FREE"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Oracle APEX 18.1"}),(0,n.jsx)(t.td,{children:"FREE"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"SQL Developer 18.2"}),(0,n.jsx)(t.td,{children:"FREE"})]})]})]})]})}function d(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},33952:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/john-michael-thomson-555276-unsplash_1280x720-0a6a521aeb39e538f8d02b20e9a9ef5c.jpg"},4344:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/oracle-text-cr-49b99efe287d16959369ce6b27680aaf.jpg"},25995:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/oracle-text-ig-settings-8f008ea773d1ea2414a41e51fbecf0d3.jpg"},83527:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/oracle-text-ig-03ed7d2e98e33e9c88c8cd6c922debff.jpg"},11151:(e,t,a)=>{a.d(t,{Z:()=>o,a:()=>i});var n=a(67294);const r={},s=n.createContext(r);function i(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);