"use strict";(self.webpackChunknewsite=self.webpackChunknewsite||[]).push([[83337],{38422:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var n=i(85893),o=i(11151);const r={title:"Certs for APEX Social Sign-In",tags:["orclapex","oauth2","authentication","google","microsoft","facebook","sso","single sign-on"],slug:"id/1725",authors:["fuzziebrain"],categories:["Technology","Programming","Oracle Application Express"],date:new Date("2018-11-17T14:25:02.000Z")},s=void 0,a={permalink:"/content/id/1725",source:"@site/posts/certs-for-apex-social-sign-in/index.md",title:"Certs for APEX Social Sign-In",description:"Verified!",date:"2018-11-17T14:25:02.000Z",formattedDate:"November 17, 2018",tags:[{label:"orclapex",permalink:"/content/tags/orclapex"},{label:"oauth2",permalink:"/content/tags/oauth-2"},{label:"authentication",permalink:"/content/tags/authentication"},{label:"google",permalink:"/content/tags/google"},{label:"microsoft",permalink:"/content/tags/microsoft"},{label:"facebook",permalink:"/content/tags/facebook"},{label:"sso",permalink:"/content/tags/sso"},{label:"single sign-on",permalink:"/content/tags/single-sign-on"}],readingTime:3.56,hasTruncateMarker:!0,authors:[{name:"Adrian Png",title:"Senior Cloud Solutions Architect @ Insum",url:"https://github.com/fuzziebrain",imageURL:"https://github.com/fuzziebrain.png",key:"fuzziebrain"}],frontMatter:{title:"Certs for APEX Social Sign-In",tags:["orclapex","oauth2","authentication","google","microsoft","facebook","sso","single sign-on"],slug:"id/1725",authors:["fuzziebrain"],categories:["Technology","Programming","Oracle Application Express"],date:"2018-11-17T14:25:02.000Z"},unlisted:!1,prevItem:{title:"Tell Lora I Need Her",permalink:"/content/id/1726"},nextItem:{title:"APEX and XE - A Match for Data Science",permalink:"/content/id/1724"}},c={authorsImageUrls:[void 0]},l=[{value:"Helper Script",id:"helper-script",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,o.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Verified!",src:i(33766).Z+"",width:"1280",height:"720"})}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Updated November 18, 2018"}),"\nAdded a help utility to populate an Oracle Wallet with root certificates"]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Oracle Database 18c Express Edition comes with a usable Oracle Wallet. In a previous ",(0,n.jsx)(t.a,{href:"/content/id/1720/",children:"article"}),", I had described how to:"]}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"Obtain the certificates necessary to make a successful SSL/TLS connection."}),"\n",(0,n.jsx)(t.li,{children:"Create and add these certificates to the Oracle Wallet."}),"\n",(0,n.jsx)(t.li,{children:"Configure the APEX instance to use the wallet."}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Someone had asked in the comments, what certificates were necessary for Social Sign-in in ",(0,n.jsx)(t.a,{href:"https://apex.oracle.com",children:"Oracle Application Express"})," (APEX) to work. It's something that I think most of us would like to know too, so I did a little more digging and here's what I found for three of the more popular social platforms: Google, Facebook and Microsoft."]}),"\n",(0,n.jsxs)(t.p,{children:["Fortunately, the discovery I did for another previous ",(0,n.jsx)(t.a,{href:"/content/id/1711/",children:"work"})," on circumventing wallet issues helped in determining which URLs were called by the authentication workflow. To add a Generic OAuth2 Provider, three of these are required: Authorization, Token and User Info endpoints."]}),"\n",(0,n.jsx)(t.p,{children:"When the authentication process begins, the user is first redirected to the Authorization endpoint and that interaction is performed through the browser. Upon successful authentication, the Identity Provider (IdP) then calls the APEX authentication callback URL with the necessary parameters. APEX calls the Token and User Info to obtain an access token and user information respectively. These are made through the APEX_WEB_SERVICE APIs and hence, the certificates for these two endpoints will be required. Here they are:"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"IdP"}),(0,n.jsx)(t.th,{children:"Endpoint"}),(0,n.jsx)(t.th,{children:"URL"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Google"}),(0,n.jsx)(t.td,{children:"Token"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://www.googleapis.com/oauth2/v4/token",children:"https://www.googleapis.com/oauth2/v4/token"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{}),(0,n.jsx)(t.td,{children:"User Info"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://www.googleapis.com/oauth2/v2/userinfo",children:"https://www.googleapis.com/oauth2/v2/userinfo"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsxs)(t.td,{children:["Facebook",(0,n.jsx)("sup",{children:"*"})]}),(0,n.jsx)(t.td,{children:"Token"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://graph.facebook.com/v2.10/oauth/access_token",children:"https://graph.facebook.com/v2.10/oauth/access_token"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{}),(0,n.jsx)(t.td,{children:"User Info"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://graph.facebook.com/v2.10/me",children:"https://graph.facebook.com/v2.10/me"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Microsoft"}),(0,n.jsx)(t.td,{children:"Token"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://login.microsoftonline.com/common/oauth2/v2.0/token",children:"https://login.microsoftonline.com/common/oauth2/v2.0/token"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{}),(0,n.jsx)(t.td,{children:"User Info"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://graph.microsoft.com/v1.0/me",children:"https://graph.microsoft.com/v1.0/me"})})]})]})]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)("sup",{children:"*"})," Based on the findings of ",(0,n.jsx)(t.a,{href:"https://twitter.com/dgielis",children:"Dimitri Gielis"})," in this comprehensive ",(0,n.jsx)(t.a,{href:"http://dgielis.blogspot.com/2018/06/facebook-google-and-custom.html",children:"blog post"})]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Using the OpenSSL client, we can obtain the necessary certificates like we did ",(0,n.jsx)(t.a,{href:"/content/id/1720/",children:"before"}),". However, I'd like to highlight an important issue that I had missed in the previous post, and that is how to obtain the ",(0,n.jsx)(t.strong,{children:"root certificates"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["During the ",(0,n.jsx)(t.a,{href:"https://knowledge.digicert.com/solution/SO16297.html",children:"certificate validation process"}),", the full chain is needed to verify and trust the server certificate presented by the web service. Servers however, are not required to include the root certificate. Clients are expected to have those in the trust store and in fact, should ignore any root certificates that a server might send over the channel. Hence, when we attempted to retrieve the certificates for import into the Oracle Wallet, only the server and intermediate certificates were returned."]}),"\n",(0,n.jsx)(t.p,{children:"By importing only the intermediate certificates though, it looks like there's an implicit trust that the certificates were correctly signed and will validate even if you do not have the root certificates in the wallet. Always download these intermediate certificates with eyes wide open. The OpenSSL client does attempt to verify the certificates, so keep a look out for a message like this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"$ openssl s_client -connect sha1-intermediate.badssl.com:443 -showcerts\n...\n---\nSSL handshake has read 1938 bytes and written 302 bytes\nVerification error: unable to verify the first certificate\n---\n...\n"})}),"\n",(0,n.jsx)(t.p,{children:"Or towards the end:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-plaintext",children:"Verify return code: 21 (unable to verify the first certificate)\n"})}),"\n",(0,n.jsx)(t.p,{children:"Assuming that these web services always transmit all the intermediate certificates, then we could reduce the amount of work by adding the root certificates to complete the trust chain. Based on the OpenSSL outputs, today, these are:"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"IdP"}),(0,n.jsx)(t.th,{children:"Root Certificate"}),(0,n.jsx)(t.th,{children:"Source"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Google"}),(0,n.jsxs)(t.td,{children:["GlobalSign (expected to change, see ",(0,n.jsx)(t.a,{href:"https://security.googleblog.com/2017/01/the-foundation-of-more-secure-web.html",children:"announcement"}),")"]}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://pki.goog",children:"Google"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Facebook"}),(0,n.jsx)(t.td,{children:"DigiCert High Assurance EV Root CA"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://www.digicert.com/digicert-root-certificates.htm",children:"Digicert"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Microsoft"}),(0,n.jsx)(t.td,{children:"Baltimore CyberTrust Root"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://www.digicert.com/digicert-root-certificates.htm",children:"Digicert"})})]})]})]}),"\n",(0,n.jsxs)(t.p,{children:["If you trusted Google enough, they maintain a ",(0,n.jsx)(t.a,{href:"https://pki.goog/roots.pem",children:"collection"})," of root certificates that contains all the certificates above. Adding all the root certificates in this file will probably allow access to nearly every legitimate and secure web service on the planet. Alternatively, if OpenSSL is installed, and it probably is, then these certificates can also be found in ",(0,n.jsx)(t.code,{children:"/etc/ssl/certs"})," or ",(0,n.jsx)(t.code,{children:"/etc/pki/tls"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"helper-script",children:"Helper Script"}),"\n",(0,n.jsxs)(t.p,{children:["A simple Bash ",(0,n.jsx)(t.a,{href:"https://gist.github.com/fuzziebrain/202f902d8fc6d8de586da5097a501047",children:"script"})," to help populate an Oracle Wallet with bundled root certificates obtained from a reliable source."]})]})}function d(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},33766:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/seal-1280x720-32004e3277c3a8a3b0d2de6546c7a9db.jpg"},11151:(e,t,i)=>{i.d(t,{Z:()=>a,a:()=>s});var n=i(67294);const o={},r=n.createContext(o);function s(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);